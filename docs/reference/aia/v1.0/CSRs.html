<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V Ratified Specifications Library</title>
    <link rel="prev" href="intro.html">
    <link rel="next" href="IMSIC.html">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="3f4ce2c51445edcfc62ee1f59ab97fffc218fb79"> 
    <meta name="version" content="v1.0">
    <meta name="component" content="aia">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<link rel="stylesheet" type="text/css" href="/styles.css">

<header class="header" id="antora-header">
    <nav class="navbar">
        <head>
            <link data-rh="true" rel="icon" href="/img/favicon.ico">
            <link data-rh="true" rel="canonical" href="https://developer.riscv.org/ref">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="en">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="x-default">
            <link data-rh="true" rel="preconnect" href="https://MGVPU7BN22-dsn.algolia.net" crossorigin="anonymous">
            <link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="RISC-V Developer Portal RSS Feed">
            <link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="RISC-V Developer Portal Atom Feed">

            <link rel="search" type="application/opensearchdescription+xml" title="RISC-V Developer Portal" href="/opensearch.xml">
            <link rel="stylesheet" href="/assets/css/styles.2a6e33aa.css">
            <script src="/assets/js/runtime~main.1f8bbb5b.js" defer="defer"></script>
            <script src="/assets/js/main.0e5d05c8.js" defer="defer"></script>
        </head>
        <script>
            !function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())
        </script>
            <link rel="preload" as="image" href="/img/logo.svg">
            <div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div>
            <div class="announcementBar_mb4j" role="banner">
                <div class="announcementBarPlaceholder_vyr4"></div>
                <div class="content_knG7 announcementBarContent_xLdY">congratulations, you found the RISC-V Developer Portal! ðŸŽ‰ . This site is under active development and not meant for public consumption yet.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div>
            <nav aria-label="Main" class="navbar ">
                <div class="navbar__inner">
                    <div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button>
                        <a class="navbar__brand" href="/">
                            <div class="navbar__logo"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Specifications</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/isa">ISA</a></li>
                                <li><a class="dropdown__link" href="/docs/spec/profiles">Profiles</a></li>
                                <li><a class="dropdown__link" docid="spec/non-isa" href="/docs/spec/non-isa">Non-ISA</a></li>
                            </ul>
                        </div>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developers</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/intro">Specification Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/hardware/overview">Hardware Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/software/overview">Software Developers</a></li>
                            </ul>
                        </div><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://riscv.org/community/calendar/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div>
                    <div class="navbar__items navbar__items--right">
                        <div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div>
                        <div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div>
                    </div>
                </div>
                <div role="presentation" class="navbar-sidebar__backdrop"></div>
            </nav>
            <div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper__tJE"></div>
        

    </nav>
</header><div class="body">
<div class="nav-container" data-component="aia" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Advanced Interrupt Architecture</span>
  <span class="version">v1.0</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">RISC-V Advanced Interrupt Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="intro.html">Introduction</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link"  href="CSRs.html">Control and Status Registers (CSRs) Added to Harts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IMSIC.html">Incoming MSI Controller (IMSIC)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="AdvPLIC.html">Advanced Platform-Level Interrupt Controller (APLIC)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="MSLevel.html">Interrupts for Machine and Supervisor Levels</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="VSLevel.html">Interrupts for Virtual Machines (VS Level)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IPIs.html">Interprocessor Interrupts (IPIs)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IOMMU.html">IOMMU Support for MSIs to Virtual Machines</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/riscv/riscv-aia/edit/antora-refactor/modules/ROOT/pages/CSRs.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/riscv/riscv-aia" title="GitHub">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>

      <a href="" title="PDF">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          Download PDF
        </a>
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li><a href="index.html">Advanced Interrupt Architecture</a></li>
      <li>RISC-V Advanced Interrupt Architecture</li>
      <li><a href="CSRs.html">Control and Status Registers (CSRs) Added to Harts</a></li>
    </ul>
  </nav>
</div><div class="sect1">
<h2 id="CSRs"><a class="anchor" href="#CSRs"></a>Control and Status Registers (CSRs) Added to Harts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each privilege level at which a RISC-V hart can take interrupt traps, the
Advanced Interrupt Architecture adds CSRs for interrupt control and
handling.</p>
</div>
<div class="sect2">
<h3 id="machine-level-csrs"><a class="anchor" href="#machine-level-csrs"></a>Machine-level CSRs</h3>
<div class="paragraph">
<p><a href="#CSRs-M">Machine-level CSRs added or widened by the Advanced Interrupt Architecture.</a> lists both the CSRs added for machine
level and existing machine-level CSRs whose size is changed by the
Advanced Interrupt Architecture. Existing CSRs <code>mie</code>, <code>mip</code>, and <code>mideleg</code> are widened to 64 bits to support a total of 64 interrupt causes.</p>
</div>
<div class="paragraph">
<p>For RV32, the <em>high-half</em> CSRs listed in the table allow access to the
upper 32 bits of registers <code>mideleg</code>, <code>mie</code>, <code>mvien</code>, <code>mvip</code>, and <code>mip</code>. The Advanced Interrupt Architecture requires that these high-half CSRs exist for RV32, but the bits they access may all be merely read-only zeros.</p>
</div>
<div class="paragraph">
<p>CSRs <code>miselect</code> and <code>mireg</code> provide a window for accessing multiple registers beyond the CSRs in <a href="#CSRs-M">Machine-level CSRs added or widened by the Advanced Interrupt Architecture.</a>. The value of <code>miselect</code> determines which
register is currently accessible through alias CSR <code>mireg</code>. <code>miselect</code> is a <strong>WARL</strong> register, and it must support a minimum range of values depending on the implemented features. When an IMSIC is not implemented, <code>miselect</code> must be able to hold at least any 6-bit value in the range 0 to 0<code>x3F</code>. When an IMSIC is implemented, <code>miselect</code> must be able to hold any 8-bit value in the range 0 to 0<code>xFF</code>.
The Advanced Interrupt Architecture makes use
of these subranges of values for <code>miselect</code>:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x30-0x3F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">major interrupt priorities</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x70-0xFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external interrupts (only with an IMSIC)</p></td>
</tr>
</tbody>
</table>
<table id="CSRs-M" class="tableblock frame-all grid-all fit-content center">
<caption class="title">Table 1. Machine-level CSRs added or widened by the Advanced Interrupt Architecture.</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Number</th>
<th class="tableblock halign-center valign-top">Privilege</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Machine-Level Window to Indirectly Accessed Registers</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x350<br>
0x351</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW<br>
MRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">XLEN<br>
XLEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>miselect</code><br>
<code>mireg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine indirect register select<br>
Machine indirect register alias</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Machine-Level Interrupts</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x304<br>
0x344<br>
0x35C<br>
0xFB0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW<br>
MRW<br>
MRW<br>
MRO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64<br>
64<br>
MXLEN<br>
MXLEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mie</code><br>
<code>mip</code><br>
<code>mtopei</code><br>
<code>mtopi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt-enable bits<br>
Machine interrupt-pending bits<br>
Machine top external interrupt (only with an IMSIC)<br>
Machine top interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Delegated and Virtual Interrupts for Supervisor Level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x303<br>
0x308<br>
0x309</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW<br>
MRW<br>
MRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64<br>
64<br>
64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mideleg</code><br>
<code>mvien</code><br>
<code>mvip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt delegation<br>
Machine virtual interrupt enables<br>
Machine virtual interrupt-pending bits</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Machine-Level High-Half CSRs (RV32 only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x313<br>
0x314<br>
0x318<br>
0x319<br>
0x354</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MRW<br>
MRW<br>
MRW<br>
MRW<br>
MRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32<br>
32<br>
32<br>
32<br>
32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>midelegh</code><br>
<code>mieh</code><br>
<code>mvienh</code><br>
<code>mviph</code><br>
<code>miph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upper 32 bits of <code>mideleg</code> (only with S-mode)<br>
Upper 32 bits of <code>mie</code><br>
Upper 32 bits of <code>mvien</code> (only with S-mode)<br>
Upper 32 bits of <code>mvip</code> (only with S-mode)<br>
Upper 32 bits of <code>mip</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Values of <code>miselect</code> with the most-significant bit set (bit
<code>XLEN - 1</code> = <code>1</code>) are designated for custom use,
presumably for accessing custom registers through <code>mireg</code>. If <code>XLEN</code> changes, the
most-significant bit of <code>miselect</code> moves to the new position, retaining its value
from before. An implementation is not required to support any custom
values for <code>miselect</code>.</p>
</div>
<div class="paragraph">
<p>Other <code>miselect</code> values are reserved for other RISC-V extensions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>RISC-V extension Smcsrind generalizes the mechanism of
indirect register access provided by <code>miselect</code> and <code>mireg</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Normally, the range for external interrupts, 0x70-0xFF, is populated only when
an IMSIC is implemented; else, attempts to access <code>mireg</code> when <code>miselect</code> is in this range
cause an illegal instruction exception. The contents of the
external-interrupts region are documented in
<a href="#IMSIC">[IMSIC]</a> on the IMSIC.</p>
</div>
<div class="paragraph">
<p>CSR <code>mtopei</code> also exists only when an IMSIC is implemented, so is documented in
<a href="#IMSIC">[IMSIC]</a> along with the indirectly accessed IMSIC
registers.</p>
</div>
<div class="paragraph">
<p>CSR <code>mtopi</code> reports the highest-priority interrupt that is pending and enabled
for machine level, as specified in <a href="#mtopi">[mtopi]</a>.</p>
</div>
<div class="paragraph">
<p>When S-mode is implemented, CSRs <code>mvien</code> and <code>mvip</code> support interrupt filtering and
virtual interrupts for supervisor level. These facilities are explained
in <a href="#virtIntrs-S">[virtIntrs-S]</a>.</p>
</div>
<div class="paragraph">
<p>If extension Smcsrind is also implemented, then when <code>miselect</code> has a value in the
range 0x30-0x3F
or 0x70-0xFF, attempts to access alias CSRs <code>mireg2</code> through <code>mireg6</code> raise an illegal
instruction exception.</p>
</div>
</div>
<div class="sect2">
<h3 id="supervisor-level-csrs"><a class="anchor" href="#supervisor-level-csrs"></a>Supervisor-level CSRs</h3>
<div class="paragraph">
<p><a href="#CSRs-S">Supervisor-level CSRs added or widened by the Advanced Interrupt Architecture.</a> lists the supervisor-level CSRs that are
added and existing CSRs that are widened to 64 bits, if the hart
implements S-mode. The functions of these registers all match their
machine-level counterparts.</p>
</div>
<table id="CSRs-S" class="tableblock frame-all grid-all fit-content center">
<caption class="title">Table 2. Supervisor-level CSRs added or widened by the Advanced Interrupt Architecture.</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Number</th>
<th class="tableblock halign-center valign-top">Privilege</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Supervisor-Level Window to Indirectly Accessed Registers</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x150<br>
0x151</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">SRW<br>
SRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">XLEN<br>
XLEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>siselect</code><br>
<code>sireg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supervisor indirect register select<br>
Supervisor indirect register alias</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Supervisor-Level Interrupts</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x104<br>
0x144<br>
0x15C<br>
0xDB0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">SRW<br>
SRW<br>
SRW<br>
SRO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64<br>
64<br>
SXLEN<br>
SXLEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sie</code><br>
<code>sip</code><br>
<code>stopei</code><br>
<code>stopi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supervisor interrupt-enable bits<br>
Supervisor interrupt-pending bits<br>
Supervisor top external interrupt (only with an IMSIC)<br>
Supervisor top interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Supervisor-Level High-Half CSRs (RV32 only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x114<br>
0x154</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">SRW<br>
SRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32<br>
32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sieh</code><br>
<code>siph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upper 32 bits of <code>sie</code><br>
Upper 32 bits of <code>sip</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The space of registers accessible through the <code>siselect</code>/<code>sireg</code> window is separate from
but parallels that of machine level, being for supervisor-level
interrupts instead of machine-level interrupts.
The subranges of values used for <code>siselect</code> are once again these:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x30-0x3F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">major interrupt priorities</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x70-0xFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external interrupts (only with an IMSIC)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For maximum compatibility, it is recommended that <code>siselect</code> support at least a
9-bit range, <code>0</code> to <code>0x1FF</code>, regardless of whether an IMSIC exists.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because the VS CSR <code>vsiselect</code> (<a href="#hypervisor-vs-csrs">Hypervisor and VS CSRs</a>) always has at
least 9 bits, and like other VS CSRs, <code>vsiselect</code> substitutes for <code>siselect</code> when executing in
a virtual machine (VS-mode or VU-mode), implementing a smaller range for
<code>siselect</code> allows software to discover it is not running in a virtual machine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like <code>miselect</code>, values of <code>siselect</code> with the most-significant bit set (bit
XLEN - 1 = 1) are designated for custom use.
If XLEN changes, the most-significant bit of <code>siselect</code> moves to the new position,
retaining its value from before. An implementation is not required to
support any custom values for <code>siselect</code>.</p>
</div>
<div class="paragraph">
<p>Other <code>siselect</code> values are reserved for other RISC-V extensions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>At supervisor level, extension Sscsrind generalizes the mechanism
of indirect register access provided by <code>siselect</code> and <code>sireg</code>,
as well as the parallel at VS-level provided by <code>vsiselect</code> and <code>vsireg</code>,
described in the next subsection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the widths of 'siselect' and 'sireg' are always the current XLEN rather than
SXLEN. Hence, for example, if MXLEN = 64 and SXLEN = 32, then these
registers are 64 bits when the current privilege mode is M (running RV64
code) but 32 bits when the privilege mode is S (RV32 code).</p>
</div>
<div class="paragraph">
<p>CSR <code>stopei</code> is described with the IMSIC in <a href="#IMSIC">[IMSIC]</a>.</p>
</div>
<div class="paragraph">
<p>Register <code>stopi</code> reports the highest-priority interrupt that is pending and
enabled for supervisor level, as specified in
<a href="#stopi">[stopi]</a>.</p>
</div>
<div class="paragraph">
<p>If extension Sscsrind is also implemented, then when <code>siselect</code> has a value in the range <code>0x30-0x3F</code> or <code>0x70-0xFF</code>, attempts to access alias CSRs <code>sireg2</code> through <code>sireg6</code> raise an illegal instruction exception (unless executing in a virtual machine, covered in the next section).</p>
</div>
</div>
<div class="sect2">
<h3 id="hypervisor-vs-csrs"><a class="anchor" href="#hypervisor-vs-csrs"></a>Hypervisor and VS CSRs</h3>
<div class="paragraph">
<p>If a hart implements the H extension,
then the hypervisor and VS CSRs listed in <a href="#CSRs-hypervisor">Hypervisor and VS CSRs added or widened by the Advanced Interrupt Architecture. (Parameter HSXLEN is just another name for SXLEN for hypervisor-extended S-mode).</a> are also either added or widened to 64 bits.</p>
</div>
<div class="paragraph">
<p>The new hypervisor CSRs in the table (<code>hvien</code>, <code>hvictl</code> , <code>hviprio1</code>, and <code>hviprio2</code>) augment <code>hvip</code> for injecting interrupts into VS level. The use of these registers is covered in <a href="#VSLevel">[VSLevel]</a> on interrupts for virtual machines.</p>
</div>
<div class="paragraph">
<p>The new VS CSRs (<code>vsiselect</code>, <code>vsireg</code>, <code>vstopei</code>, and <code>vstopi</code>) all match supervisor CSRs, and substitute for those supervisor CSRs when executing in a virtual machine (in VS-mode or VU-mode).</p>
</div>
<div class="paragraph">
<p>CSR <code>vsiselect</code> is required to support at least a 9-bit range of <code>0</code> to <code>0x1FF</code>, whether or not an IMSIC is implemented. As with <code>siselect</code>, values of <code>vsiselect</code> with the most-significant bit set (bit XLEN - 1 = 1) are designated for custom use. If XLEN changes, the most-significant bit
of <code>vsiselect</code> moves to the new position, retaining its value from before.</p>
</div>
<div class="paragraph">
<p>Like <code>siselect</code> and <code>sireg</code>, the widths of <code>vsiselect</code> and <code>vsireg</code> are always the current XLEN rather than VSXLEN. Hence, for example, if HSXLEN = 64 and VSXLEN = 32, then these registers are 64 bits when accessed by a hypervisor in HS-mode (running RV64 code) but 32 bits for a guest OS in VS-mode (RV32 code).</p>
</div>
<table id="CSRs-hypervisor" class="tableblock frame-all grid-all stretch center">
<caption class="title">Table 3. Hypervisor and VS CSRs added or widened by the Advanced Interrupt Architecture. (Parameter HSXLEN is just another name for SXLEN for hypervisor-extended S-mode).</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 46.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Number</th>
<th class="tableblock halign-center valign-top">Privilege</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Delegated and Virtual Interrupts, Interrupt Priorities, for VS Level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x603<br>
0x608<br>
0x609<br>
0x645<br>
0x646<br>
0x647</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">HRW<br>
HRW<br>
HRW<br>
HRW<br>
HRW<br>
HRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64<br>
64<br>
HSXLEN<br>
64<br>
64<br>
64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hideleg</code><br>
<code>hvien</code><br>
<code>hvictl</code><br>
<code>hvip</code><br>
<code>hviprio1</code><br>
<code>hviprio2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hypervisor interrupt delegation<br>
Hypervisor virtual interrupt enables<br>
Hypervisor virtual interrupt control<br>
Hypervisor virtual interrupt-pending bits<br>
Hypervisor VS-level interrupt priorities<br>
Hypervisor VS-level interrupt priorities</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">VS-Level Window to Indirectly Accessed Registers</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x250<br>
0x251</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">HRW<br>
HRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">XLEN<br>
XLEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vsiselect</code><br>
<code>vsireg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual supervisor indirect register select<br>
Virtual supervisor indirect register alias</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">VS-Level Interrupts</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x204<br>
0x244<br>
0x25C<br>
&nbsp;<br>
0xEB0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">HRW<br>
HRW<br>
HRW<br>
&nbsp;<br>
HRO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64<br>
64<br>
VSXLEN<br>
&nbsp;<br>
VSXLEN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vsie</code><br>
<code>vsip</code><br>
<code>vstopei</code><br>
&nbsp;<br>
<code>vstopi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual supervisor interrupt-enable bits<br>
Virtual supervisor interrupt-pending bits<br>
Virtual supervisor top external interrupt<br>
 (only with an IMSIC)<br>
Virtual supervisor top interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock">Hypervisor and VS-Level High-Half CSRs (RV32 only)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x613<br>
0x618<br>
0x655<br>
0x656<br>
0x657<br>
0x214<br>
0x254</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">HRW<br>
HRW<br>
HRW<br>
HRW<br>
HRW<br>
HRW<br>
HRW</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32<br>
32<br>
32<br>
32<br>
32<br>
32<br>
32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hidelegh</code><br>
<code>hvienh</code><br>
<code>hviph</code><br>
<code>hviprio1h</code><br>
<code>hviprio2h</code><br>
<code>vsieh</code><br>
<code>vsiph</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upper 32 bits of <code>hideleg</code><br>
Upper 32 bits of <code>hvien</code><br>
Upper 32 bits of <code>hvip</code><br>
Upper 32 bits of <code>hviprio1</code><br>
Upper 32 bits of <code>hviprio2</code><br>
Upper 32 bits of <code>vsie</code><br>
Upper 32 bits of <code>vsip</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The space of registers selectable by <code>vsiselect</code> is more limited than for machine and supervisor levels:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x030-0x03F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inaccessible</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x070-0x0FF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external interrupts (IMSIC only), or inaccessible</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Other <code>vsiselect</code> values are reserved for other RISC-V extensions.</p>
</div>
<div class="paragraph">
<p>For alias CSRs <code>sireg</code> and <code>vsireg</code>, the H extension&#8217;s usual rules for when to raise a virtual instruction exception (based on whether an instruction is <em>HS-qualified</em>) are not applicable. The rules given in this section for <code>sireg</code> and <code>vsireg</code> apply instead, unless overridden by the requirements of <a href="#CSRs-stateen">Access control by the state-enable CSRs</a>, which take precedence over this section
when extension Smstateen is also implemented.</p>
</div>
<div class="paragraph">
<p>A virtual instruction exception is raised for attempts from VS-mode or
VU-mode to directly access <code>vsireg</code>, or attempts from VU-mode to access <code>sireg</code>.</p>
</div>
<div class="paragraph">
<p>When <code>vsiselect</code> has the number of an <em>inaccessible</em> register, attempts from M-mode or HS-mode to access <code>vsireg</code> raise an illegal instruction exception, and attempts from VS-mode to access <code>sireg</code> (really <code>vsireg</code>) raise a virtual instruction exception.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Requiring a range of 0-0x1FF for <code>vsiselect</code>, even though most or all of the space is reserved or inaccessible, permits a hypervisor to emulate indirectly
accessed registers in the implemented range, including registers that
are not currently defined but may be standardized in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The indirectly accessed registers for external interrupts (numbers 0x70-0xFF)
are accessible only when field VGEIN of <code>hstatus</code> is the number of an implemented guest external interrupt, not zero. If VGEIN is not the number of an implemented guest external interrupt (including the case when no IMSIC
is implemented), then all indirect register numbers in the ranges 0x030-0x03F and 0x070-0x0FF designate an inaccessible register at VS level.</p>
</div>
<div class="paragraph">
<p>Along the same lines, when <code>hstatus.VGEIN</code> is not the number of an implemented
guest external interrupt, attempts from M-mode or HS-mode to access CSR <code>vstopei</code> raise an illegal instruction exception, and attempts from VS-mode to
access <code>stopei</code> raise a virtual instruction exception.</p>
</div>
<div class="paragraph">
<p>If extension Sscsrind is also implemented, then when <code>vsiselect</code> has a value in the range 0x30-0x3F or 0x70-0xFF, attempts from M-mode or HS-mode to access alias CSRs <code>vsireg2</code> through <code>vsireg6</code> raise an illegal instruction exception, and attempts from VS-mode to access <code>sireg2</code> through <code>sireg6</code> raise a virtual instruction exception.</p>
</div>
</div>
<div class="sect2">
<h3 id="virtual-instruction-exceptions"><a class="anchor" href="#virtual-instruction-exceptions"></a>Virtual instruction exceptions</h3>
<div class="paragraph">
<p>Following the default rules for the H extension, attempts from
VS-mode to directly access a hypervisor or VS CSR other than <code>vsireg</code>, or from
VU-mode to access any supervisor-level CSR (including hypervisor and VS
CSRs) other than <code>sireg</code> or <code>vsireg</code>, usually raise not an illegal instruction exception but instead a virtual instruction exception. For details, see the H extension documentation.</p>
</div>
<div class="paragraph">
<p>Instructions that read/write CSR <code>stopei</code> or <code>vstopei</code> are considered to be <em>HS-qualified</em> unless all of following are true: the hart has an IMSIC, extension Smstateen is implemented, and bit 58 of <code>mstateen0</code> is zero. (See the next section, <a href="#CSRs-stateen">Access control by the state-enable CSRs</a>, about <code>mstateen0</code>.)</p>
</div>
<div class="paragraph">
<p>For <code>sireg</code> and <code>vsireg</code>, see both the previous section, <a href="#hypervisor-vs-csrs">Hypervisor and VS CSRs</a>, and the next, <a href="#CSRs-stateen">Access control by the state-enable CSRs</a>, for when a virtual instruction exception is required instead of an illegal instruction exception.</p>
</div>
</div>
<div class="sect2">
<h3 id="CSRs-stateen"><a class="anchor" href="#CSRs-stateen"></a>Access control by the state-enable CSRs</h3>
<div class="paragraph">
<p>If extension Smstateen is implemented together with the Advanced
Interrupt Architecture (AIA), three bits of state-enable register <code>mstateen0</code> control access to AIA-added state from privilege modes less privileged
than M-mode:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 60 CSRIND: CSRs <code>siselect</code>, <code>sireg</code>, <code>vsiselect</code>, and <code>vsireg</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 59 AIA: all other state added by the AIA and not controlled by bits CSRIND and IMSIC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 58 IMSIC: all IMSIC state, including CSRs <code>stopei</code> and <code>vstopei</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If one of these bits is zero in <code>mstateen0</code>, an attempt to access the corresponding state from a privilege mode less privileged than M-mode results in an illegal instruction trap. As always, the state-enable CSRs do not affect
the accessibility of any state when in M-mode, only in less privileged modes. For more explanation, see the documentation for extension Smstateen.</p>
</div>
<div class="paragraph">
<p>The AIA bit controls access to AIA CSRs <code>siph</code>, <code>sieh</code>, <code>stopi</code>, <code>hidelegh</code>, <code>hvien</code>/<code>hvienh</code>, <code>hviph</code>, <code>hvictl</code>, <code>hviprio1</code>/<code>hviprio1h</code>, <code>hviprio2</code>/<code>hviprio2h</code>, <code>vsiph</code>, <code>vsieh</code>, and <code>vstopi</code>, as well as to the supervisor-level interrupt priorities accessed through <code>siselect</code> + <code>sireg</code> (the <code>iprio</code> array of <a href="#intrPrios-S">[intrPrios-S]</a>).</p>
</div>
<div class="paragraph">
<p>The IMSIC bit is implemented in <code>mstateen0</code> only if the hart has an IMSIC. If the
H extension is also implemented, this bit does not affect the
behavior or accessibility of hypervisor CSRs <code>hgeip</code> and <code>hgeie</code>, or field VGEIN of <code>hstatus</code>. In particular, guest external interrupts from an IMSIC continue to be visible to HS-mode in <code>hgeip</code> even when <code>mstateen0</code>.IMSIC is zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An earlier, pre-ratification draft of Smstateen said that when <code>mstateen0</code>.IMSIC is zero, registers <code>hgeip</code> and <code>hgeie</code> and field VGEIN of <code>hstatus</code> are all read-only zeros. That effect is no longer correct.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the hart does not have an IMSIC, the IMSIC bit of <code>mstateen0</code> is read-only zero, but Smstateen has no effect on attempts to access the nonexistent IMSIC
state.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This means in particular that, when the hart does not have an IMSIC, the
following raise a virtual instruction exception as described in <a href="#CSRs-hypervisor">Hypervisor and VS CSRs added or widened by the Advanced Interrupt Architecture. (Parameter HSXLEN is just another name for SXLEN for hypervisor-extended S-mode).</a>, not an illegal instruction exception, despite that <code>mstateen0</code>.IMSIC is zero:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>attempts from VS-mode to access <code>sireg</code> (really <code>vsireg</code>) while <code>vsiselect</code> has a value in the range 0x70â€“0xFF; and</p>
</li>
<li>
<p>attempts from VS-mode to access <code>stopei</code> (really <code>vstopei</code>).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the CSRIND bit of <code>mstateen0</code> is one, then regardless of any other <code>mstateen</code> bits (including the AIA and IMSIC bits of <code>mstateen0</code>), a virtual instruction exception is raised as described in <a href="#hypervisor-vs-csrs">Hypervisor and VS CSRs</a> for all attempts from VS-mode or
VU-mode to directly access <code>vsireg</code>, and for all attempts from VU-mode to access <code>sireg</code>. This behavior is overridden only when <code>mstateen0</code>.CSRIND is zero.</p>
</div>
<div class="paragraph">
<p>If the H extension is implemented, the same three bits are
defined also in hypervisor CSR <code>hstateen0</code> but concern only the state potentially accessible to a virtual machine executing in privilege modes VS and VU:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 60 CSRIND: CSRs <code>siselect</code> and <code>sireg</code> (really <code>vsiselect</code> and <code>vsireg</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 59 AIA: CSRs <code>siph</code> and <code>sieh</code> (RV32 only) and <code>stopi</code> (really <code>vsiph</code>, <code>vsieh</code>, and <code>vstopi</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 58 IMSIC: all state of IMSIC guest interrupt files, including CSR <code>stopei</code>(really <code>vstopei</code>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If one of these bits is zero in <code>hstateen0</code>, and the same bit is one in <code>mstateen0</code>, then an attempt to access the corresponding state from VS or VU-mode raises a virtual instruction exception. (But note that, for high-half CSRs <code>siph</code> and <code>sieh</code>, this applies only when XLEN = 32. When XLEN &gt; 32, an attempt to access <code>siph</code> or <code>sieh</code> raises an illegal instruction exception as usual, not a virtual instruction exception.)</p>
</div>
<div class="paragraph">
<p>If the CSRIND bit is one in <code>mstateen0</code> but is zero in <code>hstateen0</code>, then all attempts from VS or VU-mode to access <code>siselect</code> or <code>sireg</code> raise a virtual instruction exception, not an illegal instruction exception, regardless of the value of <code>vsiselect</code> or any other <code>mstateen</code> bits.</p>
</div>
<div class="paragraph">
<p>The IMSIC bit is implemented in <code>hstateen0</code> only if the hart has an IMSIC. Furthermore, even with an IMSIC, <code>hstateen0</code>.IMSIC may (or may not) be read-only zero if the IMSIC has no <em>guest interrupt files</em> for guest external interrupts (<a href="#IMSIC">[IMSIC]</a>). When this bit is zero (whether read-only zero or set to zero), a virtual machine is prevented from accessing the hart&#8217;s IMSIC the same as when <code>hstatus.VGEIN</code> = 0.</p>
</div>
<div class="paragraph">
<p>Extension Ssstateen is defined as the supervisor-level view of Smstateen. Therefore, the combination of Ssaia and Ssstateen incorporates the bits defined above for <code>hstateen0</code> but not those for <code>mstateen0</code>, since machine-level CSRs are not visible to supervisor level.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="intro.html">Introduction</a></span>
  <span class="next"><a href="IMSIC.html">Incoming MSI Controller (IMSIC)</a></span>
</nav>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../../ffh/v1.0/index.html">ACPI Functional Fixed Hardware</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../ffh/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="index.html">Advanced Interrupt Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../etrace/v1.0/index.html">E-Trace Encapsulation Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../etrace/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../psabi/v1.0/index.html">ELF psABI Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../psabi/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../iommuArch/v1.0/index.html">IOMMU Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../iommuArch/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../isa/index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../isa/index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../reri/v1.0/index.html">RERI Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../reri/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../qos/v1.0/index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../qos/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../plic/v1.0.0/index.html">RISC-V Platform-Level Interrupt Controller</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../plic/v1.0.0/index.html">
      v1.0.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../semihost/v1.0/index.html">semihosting</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../semihost/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
