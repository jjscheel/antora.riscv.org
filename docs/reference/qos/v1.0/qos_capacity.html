<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V Ratified Specifications Library</title>
    <link rel="prev" href="qos_identifiers.html">
    <link rel="next" href="qos_bandwidth.html">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="1e2798650bcf82e415abe50a131b399fc753d9ef"> 
    <meta name="version" content="v1.0">
    <meta name="component" content="qos">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">


<header class="header" id="antora-header">
    <nav class="navbar">
        <head>
            <link data-rh="true" rel="icon" href="/img/favicon.ico">
            <link data-rh="true" rel="canonical" href="https://developer.riscv.org/ref">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="en">
            <link data-rh="true" rel="alternate" href="https://developer.riscv.org/ref" hreflang="x-default">
            <link data-rh="true" rel="preconnect" href="https://MGVPU7BN22-dsn.algolia.net" crossorigin="anonymous">
            <link rel="stylesheet" type="text/css" href="/docs/reference/_/docusaurus-styles-copy-08-25.css">

        </head>
        <script>
            !function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())
        </script>
            <link rel="preload" as="image" href="/img/logo.svg">
            <div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div>
            <div class="announcementBar_mb4j" role="banner">
                <div class="announcementBarPlaceholder_vyr4"></div>
                <div class="content_knG7 announcementBarContent_xLdY">congratulations, you found the RISC-V Developer Portal! ðŸŽ‰ . This site is under active development and not meant for public consumption yet.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div>
            <nav aria-label="Main" class="navbar ">
                <div class="navbar__inner">
                    <div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button>
                        <a class="navbar__brand" href="/">
                            <div class="navbar__logo"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="RISC-V Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Home</b></a>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Specifications</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/isa">ISA</a></li>
                                <li><a class="dropdown__link" href="/docs/spec/profiles">Profiles</a></li>
                                <li><a class="dropdown__link" docid="spec/non-isa" href="/docs/spec/non-isa">Non-ISA</a></li>
                            </ul>
                        </div>
                        <div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Developers</a>
                            <ul class="dropdown__menu">
                                <li><a class="dropdown__link" href="/docs/spec/intro">Specification Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/hardware/overview">Hardware Developers</a></li>
                                <li><a class="dropdown__link" href="/docs/software/overview">Software Developers</a></li>
                            </ul>
                        </div><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://riscv.org/community/calendar/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div>
                    <div class="navbar__items navbar__items--right">
                      <div class="navbarSearchContainer_Bca1">
                        <button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)">
                          <span class="DocSearch-Button-Container">
                            <svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true">
                              <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
                            </svg>
                            <span class="DocSearch-Button-Placeholder">Search</span>
                          </span>
                          <span class="DocSearch-Button-Keys"></span>
                        </button>
                      </div>
                    </div>
                </div>
                <div role="presentation" class="navbar-sidebar__backdrop"></div>
            </nav>
            <div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper__tJE"></div>
        

    </nav>
</header><div class="body">
<div class="nav-container" data-component="qos" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">RISC-V Capacity and Bandwidth QoS Register Interface</span>
  <span class="version">v1.0</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">RISC-V Capacity and Bandwidth Controller QoS Register Interface</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_contributors.html">Contributors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_identifiers.html">QoS Identifiers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link"  href="qos_capacity.html">Capacity-controller QoS Register Interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_bandwidth.html">Bandwidth-controller QoS Register Interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_iommu.html">IOMMU Extension for QoS ID</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_hw_guidelines.html">Hardware Guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="qos_sw_guidelines.html">Software Guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="https://github.com/riscv-non-isa/riscv-cbqri/releases/download/v1.0/riscv-cbqri.pdf">Download PDF</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/riscv-non-isa/riscv-cbqri/edit/antora-refactor/modules/ROOT/pages/qos_capacity.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/riscv-non-isa/riscv-cbqri" title="GitHub">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>

      
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li><a href="index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a></li>
      <li>RISC-V Capacity and Bandwidth Controller QoS Register Interface</li>
      <li><a href="qos_capacity.html">Capacity-controller QoS Register Interface</a></li>
    </ul>
  </nav>
</div><div class="sect1">
<h2 id="CC_QOS"><a class="anchor" href="#CC_QOS"></a>Capacity-controller QoS Register Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Controllers, such as cache controllers, that support capacity allocation and
usage monitoring provide a memory-mapped capacity-controller QoS register
interface.</p>
</div>
<div class="paragraph">
<p>The capacity controller allocates capacity in fixed multiples of <em>capacity
units</em>. A group of these <em>capacity units</em> is referred to as a <em>capacity block</em>.
One or more <em>capacity blocks</em> can be allocated to a workload. When a workload
requests capacity allocation, the capacity is allocated by using <em>capacity units</em>
situated within the <em>capacity blocks</em> assigned to the workload. Capacity blocks
can also be shared among one or more workloads. Optionally, the capacity
controller might allow configuration of a limit on the maximum number of <em>capacity
units</em> that can be occupied in the <em>capacity blocks</em> allocated to a specific
workload.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, a cache controller allocates capacity in multiples of cache
blocks. In this context, a cache block serves as a <em>capacity unit</em>, and a group
of cache blocks forms a <em>capacity block</em>. A cache controller supporting capacity
allocation <em>by ways</em> might define a <em>capacity block</em> to be the cache blocks in one
way of the cache.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The capacity allocation affects the decision regarding which <em>capacity blocks</em>
to use when a new <em>capacity unit</em> is requested by a workload, but usually does
not affect other operations of the controller.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, when a request is made to a cache controller, the request involves
scanning the entire cache to determine if the requested data is present. If the
data is located, then the request is fulfilled with this data, even if the
cache block containing the data was initially allocated for a different
workload. The data continues to reside in the same cache block. Consequently,
the cache lookup function remains unaffected by the capacity allocation
constraints set for the workload that initiated the request. Conversely, if the data
is not found, a new cache block must be allocated. This allocation is executed
by using the <em>capacity blocks</em> assigned to the workload that made the request.
Hence, a workload might only trigger evictions within <em>capacity blocks</em> designated
to it, but can access shared data in <em>capacity blocks</em> allocated to other
workloads.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="CC_REG" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Capacity-controller QoS Register Layout (size and offset are in bytes)</caption>
<colgroup>
<col style="width: 7.5%;">
<col style="width: 25%;">
<col style="width: 10%;">
<col style="width: 45%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Offset</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Optional?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_capabilities</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_CAP">Capabilities </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_mon_ctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_MCTL">Usage monitoring
                                    control</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_mon_ctr_val</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_MCTR">Monitoring
                                    counter value</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_alloc_ctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_ALLOC">Capacity
                                    allocation control </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_block_mask</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BMW</code>/8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_BMASK">Capacity
                                    block mask </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc_cunits</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CC_CUNITS">Capacity units
                                    count</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The size of the <code>cc_block_mask</code> register is determined by the <code>NCBLKS</code> field
of the <code>cc_capabilities</code> register but is always a multiple of 8 bytes. The
formula for determination of <code>BMW</code> is defined in <a href="#CC_BMASK">Capacity Block Mask (<code>cc_block_mask</code>)</a>. The offset <code>N</code> is
determined as <code>32 + BMW/8</code>.</p>
</div>
<div class="paragraph">
<p>The reset value is 0 for the following register fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cc_mon_ctl.BUSY</code> field</p>
</li>
<li>
<p><code>cc_alloc_ctl.BUSY</code> field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reset value is <code>UNSPECIFIED</code> for all other registers fields.</p>
</div>
<div class="paragraph">
<p>The capacity controllers at reset must allocate all available capacity to <code>RCID</code>
value of 0. When the capacity controller supports capacity allocation per
access-type, then all available capacity is shared by all the access-type for
<code>RCID=0</code>. The capacity allocation for all other <code>RCID</code> values is <code>UNSPECIFIED</code>.
The capacity controller behavior for handling a request with a non-zero <code>RCID</code>
value before configuring the capacity controller with capacity allocation for
that <code>RCID</code> is <code>UNSPECIFIED</code>.</p>
</div>
<div class="sect2">
<h3 id="CC_CAP"><a class="anchor" href="#CC_CAP"></a>Capacity-controller Capabilities</h3>
<div class="paragraph">
<p>The <code>cc_capabilities</code> register is a read-only register that holds the
capacity-controller capabilities.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlCw0FHIS8xNtVJQD3MNUq_VQUgZmsGl_JydfLyDUWQVDOGybkHOni64JJ1D_TxDcGoNCnCLQJUzgcsFoEgYG8MlwgOCPEFysToKyfl5aZnpVtU5iXmpQEVAzRnFBYnJqVaGBkYmtbUAANJDOA==" alt="Capacity-controller Capabilities Register">
</div>
<div class="title">Figure 1. Capacity-controller Capabilities Register</div>
</div>
<div class="paragraph">
<p>The <code>VER</code> field holds the version of the specification implemented by the
capacity controller. The low nibble is used to hold the minor version of the
specification and the upper nibble is used to hold the major version of the
specification. For example, an implementation that supports version 1.0 of the
specification reports 0x10.</p>
</div>
<div class="paragraph">
<p>The <code>NCBLKS</code> field holds the total number of allocatable <em>capacity blocks</em> in
the controller. The capacity represented by an allocatable <em>capacity block</em> is
<code>UNSPECIFIED</code>. The capacity controllers support allocating capacity in fixed
multiples of an allocatable <em>capacity block</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For example, a cache controller that defines a way of the cache as a <em>capacity
block</em> may report the number of ways as the number of allocatable <em>capacity
blocks</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>CUNITS</code> is 1, the controller supports specifying a limit on the <em>capacity
units</em> that can be occupied by an <code>RCID</code> in <em>capacity blocks</em> allocated to it.</p>
</div>
<div class="paragraph">
<p>If <code>FRCID</code> is 1, the controller supports an operation to flush and deallocate
the <em>capacity blocks</em> occupied by an <code>RCID</code>.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>When the <code>RCID</code>-prefixed mode (<code>RPFX</code>) is 1, the controller operates in <code>RPFX</code>
mode. The parameter <code>P</code> (prefixed bits) indicates the number of least significant
bits of the <code>MCID</code> carried in the request that should be prefixed by the RCID. The
controller uses <code>RCID</code> in the requests along with <code>P</code> number of least significant
bits of the <code>MCID</code> to compute an effective <code>MCID</code> (<a href="#EMCID">[EMCID]</a>). This <code>MCID</code> is used
to identify the monitoring counter. Legal values of <code>P</code> range from 0 to 12.</p>
</div>
<div class="paragraph">
<p>If <code>RPFX</code> is 0, <code>P</code> is set to 0, and the effective <code>MCID</code> is the same as the <code>MCID</code>
in the request.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_MCTL"><a class="anchor" href="#CC_MCTL"></a>Capacity Usage Monitoring Control</h3>
<div class="paragraph">
<p>The <code>cc_mon_ctl</code> register is used to control monitoring of capacity usage by a
<code>MCID</code>. When the controller does not support capacity usage monitoring the
<code>cc_mon_ctl</code> register is read-only zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1VHIS8xNtVJQ9w9Qr9VBkjGGyziGoMgYGsFlfJ09XVB1WcDlXMNC4tFlDZHMDMNlXXhAkCeqnDlcLjjEMSQ0GJehTqHBkShyRiYYpsbqKCTn56VlpltV5yTmpYIU6ShkFBckJqdaGRoYmdTWAgBWNFIF" alt="Capacity Usage Monitoring Control Register (`cc_mon_ctl`)">
</div>
<div class="title">Figure 2. Capacity Usage Monitoring Control Register (<code>cc_mon_ctl</code>)</div>
</div>
<div class="paragraph">
<p>Capacity controllers that support capacity usage monitoring implement a usage
monitoring counter for each supported <code>MCID</code>. The usage monitoring counter can
be configured to count a monitoring event. When an event matching the event
configured for the <code>MCID</code> occurs, then the monitoring counter is updated. The
event matching might optionally be filtered by the access-type identifier.</p>
</div>
<div class="paragraph">
<p>The <code>OP</code>, <code>AT</code>, <code>ATV</code>, <code>MCID</code>, and <code>EVT_ID</code> fields of the register are WARL
fields.</p>
</div>
<div class="paragraph">
<p>The <code>OP</code> field is used to instruct the controller to perform an operation listed
in <a href="#CC_MON_OP">Capacity Usage Monitoring Operations (<code>OP</code>)</a>.</p>
</div>
<table id="CC_MON_OP" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Capacity Usage Monitoring Operations (<code>OP</code>)</caption>
<colgroup>
<col style="width: 16.3265%;">
<col style="width: 12.2448%;">
<col style="width: 71.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONFIG_EVENT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure the counter selected by <code>MCID</code> to count
                             the event selected by <code>EVT_ID</code>, <code>AT</code>, and <code>ATV</code>.
                             The <code>EVT_ID</code> encodings are listed in <a href="#CC_EVT_ID">Capacity Usage Monitoring Event ID (<code>EVT_ID</code>)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ_COUNTER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot the value of the counter selected by
                             <code>MCID</code> into <code>cc_mon_ctr_val</code> register. The
                             <code>EVT_ID</code>, <code>AT</code>, and <code>ATV</code> fields are not used by
                             this operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">24-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>EVT_ID</code> field is used to program the identifier of the event to count in
the monitoring counter selected by <code>MCID</code>. The <code>AT</code> field (See <a href="#AT_ENC">[AT_ENC]</a>) is
used to program the access-type identifier to count, and its validity is indicated by the
<code>ATV</code> field. When <code>ATV</code> is 0, the counter counts requests with all access-type identifiers,
and the <code>AT</code> value is ignored.</p>
</div>
<div style="page-break-after: always;"></div>
<table id="CC_EVT_ID" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Capacity Usage Monitoring Event ID (<code>EVT_ID</code>)</caption>
<colgroup>
<col style="width: 12.7659%;">
<col style="width: 12.7659%;">
<col style="width: 74.4682%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Event ID</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>None</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter does not count.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Occupancy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter is incremented by 1 when a request with a
                             matching <code>MCID</code> and <code>AT</code> allocates a unit of
                             capacity. The counter is decremented by 1 when a
                             unit of capacity is de-allocated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128-256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>EVT_ID</code> for a <code>MCID</code> is programmed with a non-zero and legal value by
using the <code>CONFIG_EVENT</code> operation, the counter is reset to 0 and starts counting
matching events for requests with the matching <code>MCID</code> and <code>AT</code> (if <code>ATV</code> is 1).
However, if the <code>EVT_ID</code> is programmed to 0, the counter stops counting.</p>
</div>
<div class="paragraph">
<p>A controller that does not support monitoring by access-type identifier can hardwire the
<code>ATV</code> and the <code>AT</code> fields to 0, indicating that the counter counts requests with
all access-types identifiers.</p>
</div>
<div class="paragraph">
<p>When the <code>cc_mon_ctl</code> register is written, the controller can perform
several actions that might not complete synchronously with the write. A write to
the <code>cc_mon_ctl</code> sets the read-only <code>BUSY</code> bit to 1, indicating the controller
is performing the requested operation. When the <code>BUSY</code> bit reads 0, the operation
is complete, and the read-only <code>STATUS</code> field provides a status value (see
<a href="#CC_MON_STS"><code>cc_mon_ctl.STATUS</code> Field Encodings</a> for  details). Written values to the <code>BUSY</code> and the <code>STATUS</code>
fields are ignored. An implementation that can complete the operation
synchronously with the write may hardwire the <code>BUSY</code> bit to 0. The state of the
 <code>BUSY</code> bit, when not hardwired to 0, shall only change in response to a write to
the register. The <code>STATUS</code> field remains valid until a subsequent write to the
<code>cc_mon_ctl</code> register.</p>
</div>
<table id="CC_MON_STS" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. <code>cc_mon_ctl.STATUS</code> Field Encodings</caption>
<colgroup>
<col style="width: 14.6341%;">
<col style="width: 85.3659%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>STATUS</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operation was successfully completed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid operation (<code>OP</code>) was requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>MCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>EVT_ID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>AT</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6-63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>BUSY</code> bit is set to 1, the behavior of writes to the <code>cc_mon_ctl</code> is
<code>UNSPECIFIED</code>. Some implementations ignore the second write, while others
might perform the operation determined by the second write. To ensure proper
operation, software must first verify that the <code>BUSY</code> bit is 0 before writing
the <code>cc_mon_ctl</code> register.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_MCTR"><a class="anchor" href="#CC_MCTR"></a>Capacity Usage Monitoring Counter Value</h3>
<div class="paragraph">
<p>The <code>cc_mon_ctr_val</code> is a read-only register that holds a snapshot of the
counter that is selected by the <code>READ_COUNTER</code> operation. When the controller does not
support capacity usage monitoring, the <code>cc_mon_ctr_val</code> register always reads as
zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAwM9ZRyEvMTbVSUHcOCVKv1UGSUzCEy3n6hYHkYnUUkvPz0jLTrapzEvNSgYqMdBQyigsSk1OtDA2MTGprAWIZHJU=" alt="Capacity Usage Monitoring Counter Value Register (`cc_mon_ctr_val`)">
</div>
<div class="title">Figure 3. Capacity Usage Monitoring Counter Value Register (<code>cc_mon_ctr_val</code>)</div>
</div>
<div class="paragraph">
<p>The counter is valid if the <code>INV</code> field is 0. The counter is marked <code>INV</code> if
the controller determines the count to be not valid for <code>UNSPECIFIED</code> reasons.
The counters marked <code>INV</code> can become valid in future.</p>
</div>
<div class="paragraph">
<p>The counter shall not decrement below zero. If an event occur that would
otherwise result in a negative value, the counter continues to hold a value
of 0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Following a reset of the counter to zero, a capacity de-allocation attempts
to drive its value below zero. This scenario occurs when the <code>MCID</code> is
reassigned to a new workload, yet the capacity controller continues to hold
capacity that was initially allocated by the previous workload. In such cases, the
counter shall not decrement below zero and shall remain at zero. After a brief
period of execution for the new workload post-counter reset, the counter value is
expected to stabilize to reflect the capacity usage of this new workload.</p>
</div>
<div class="paragraph">
<p>Some implementations might not store the <code>MCID</code> of the request that caused the
capacity to be allocated with every unit of capacity in the controller to
optimize for the storage overheads. Such controllers, in turn, rely on
statistical sampling to report the capacity usage by tagging only a subset
of the capacity units.</p>
</div>
<div class="paragraph">
<p>Set-sampling is a technique commonly used in caches to estimate the cache
occupancy with a relatively small sample size. The basic idea behind
set-sampling is to select a subset of the cache sets and monitor only those
sets. By keeping track of the hits and misses in the monitored sets, it is
possible to estimate the overall cache occupancy with a high degree of accuracy.
The size of the subset needed to obtain accurate estimates depends on various
factors, such as the size of the cache, the cache access patterns, and the
desired accuracy level. Research cite:[SSAMPLE] shows that set-sampling can
provide statistically accurate estimates with a relatively small sample size,
such as 10% or less, depending on the cache properties and sampling technique
used.</p>
</div>
<div class="paragraph">
<p>When the controller has not observed enough samples to provide an accurate
value in the monitoring counter, it might report the counter as being <code>INV</code>
until more accurate measurements are available. This state helps to prevent inaccurate
or misleading data from being used in capacity planning or other decision-making
processes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="CC_ALLOC"><a class="anchor" href="#CC_ALLOC"></a>Capacity Allocation Control</h3>
<div class="paragraph">
<p>The <code>cc_alloc_ctl</code> register is used to configure allocation of capacity to an
<code>RCID</code> per access type (<code>AT</code>). The <code>OP</code>, <code>RCID</code> and <code>AT</code> fields in this register
are WARL. If a controller does not support capacity allocation, then this
register is read-only zero. If the controller does not support capacity
allocation per access type, then the <code>AT</code> field is read-only zero.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1VHIS8xNtVJQ9w9Qr9VBkjGGyziGoMgYGsFlgpw9XXDJhQcEeaKaaA6XCw5xDAkNRpU1hMs6hQZHosgZmWCYGqujkJyfl5aZblWdk5iXClKko5BRXJCYnGplaGBkUlsLAD1BQo0=" alt="Capacity Allocation Control Register (`cc_alloc_ctl`)">
</div>
<div class="title">Figure 4. Capacity Allocation Control Register (<code>cc_alloc_ctl</code>)</div>
</div>
<div class="paragraph">
<p>The <code>OP</code> field is used to instruct the capacity controller to perform an
operation listed in <a href="#CC_ALLOC_OP">Capacity Allocation Operations (<code>OP</code>)</a>. Some operations necessitate the
specification of the <em>capacity blocks</em> to act upon. For such operations, the
targeted <em>capacity blocks</em> are designated in the form of a bitmask in the
<code>cc_block_mask</code> register. Additionally, certain operations require the <em>capacity
unit</em> limit to be defined in the <code>cc_cunits</code> register. To execute operations that
require a capacity block mask and/or a capacity unit limit, software must first
program the <code>cc_block_mask</code> and/or the <code>cc_cunits</code> register, followed by
initiating the operation with the <code>cc_alloc_ctl</code> register.</p>
</div>
<table id="CC_ALLOC_OP" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Capacity Allocation Operations (<code>OP</code>)</caption>
<colgroup>
<col style="width: 16.3265%;">
<col style="width: 12.2448%;">
<col style="width: 71.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation</th>
<th class="tableblock halign-center valign-top">Encoding</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONFIG_LIMIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure a capacity allocation for requests by
                             <code>RCID</code> and of access type <code>AT</code>. The <em>capacity
                             blocks</em> allocation is specified in the
                             <code>cc_block_mask</code> register, and a limit on capacity
                             units is specified in the <code>cc_cunits</code> register.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ_LIMIT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read back the previously configured capacity
                             allocation for requests by <code>RCID</code> and of
                             access-type <code>AT</code>. The configured <em>capacity block</em>
                             allocation is returned as a bit-mask in the
                             <code>cc_block_mask</code> register, and the configured limit
                             on <em>capacity units</em> is available in the <code>cc_cunits</code>
                             register on successful completion of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLUSH_RCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flushes the <em>capacity units</em> used by the specified
                             <code>RCID</code> and access-type <code>AT</code>. This operation is
                             supported if the <code>capabilities.FRCID</code> bit is 1.  <br>
                                                                              <br>
                             The <code>cc_block_mask</code> and <code>cc_cunits</code> registers
                             are not used for this operation.                 <br>
                                                                              <br>
                             The configured <em>capacity block</em> allocation or the
                             <em>capacity unit</em> limit is not changed by this
                             operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">24-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>Capacity controllers enumerate the allocatable <em>capacity blocks</em> in the <code>NCBLKS</code>
field of the <code>cc_capabilities</code> register. The <code>cc_block_mask</code> register is
programmed with a bit-mask value, where each bit represents a <em>capacity block</em> for the
operation. If configuring <em>capacity unit</em> limits is supported (for example,
<code>cc_capabilities.CUNIT=1</code>), then a limit on the <em>capacity unit</em> that can be
occupied in the allocated capacity blocks can be programmed in the <code>cc_cunits</code>
register. If configuring limits is not supported, then the controller allows
the use of all <em>capacity units</em> in the allocated <em>capacity blocks</em>. A value of
zero programmed into <code>cc_cunits</code> indicates that no limits shall be enforced on
<em>capacity unit</em> allocation.</p>
</div>
<div class="paragraph">
<p>A capacity allocation must be configured for each supported access type by the
controller. An implementation that does not support capacity allocation per
access type can hardwire the <code>AT</code> field to 0 and associate the same capacity
allocation configuration for requests with all access types. When capacity
allocation per access type is supported, identical limits can be configured for
two or more access types, if different capacity allocation per access type is not
required. If capacity is not allocated for each access type supported by the
controller, the behavior is <code>UNSPECIFIED</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A cache controller that supports capacity allocation indicates the number of
allocatable <em>capacity blocks</em> in <code>cc_capabilities.NCBLKS</code> field. For example,
consider a cache with <code>NCBLKS=8</code>. In this example, the <code>RCID=5</code> is
allocated <em>capacity blocks</em> numbered 0 and 1 for requests with access type <code>AT=0</code>,
and <em>capacity blocks</em> numbered 2 for requests with access type
<code>AT=1</code>. The <code>RCID=3</code> in this example is allocated <em>capacity blocks</em>
numbered 3 and 4 for both <code>AT=0</code> and <code>AT=1</code> access types as separate capacity
allocation by access type is not required for this workload. Further in this
example, the <code>RCID=6</code> has been configured with the same <em>capacity block</em>
allocations as <code>RCID=3</code>. This configuration implies that they share a common capacity
allocation in this cache, but might be associated with different <code>RCID</code> to
allow differentiated treatment in another capacity and/or bandwidth controller.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">6</th>
<th class="tableblock halign-center valign-top">5</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=3</code>, <code>AT=0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=3</code>, <code>AT=1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=5</code>, <code>AT=0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=5</code>, <code>AT=1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=6</code>, <code>AT=0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID=6</code>, <code>AT=1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some controllers allow setting a limit on <em>capacity units</em> in allocated capacity
blocks. In exclusive allocations, like for <code>RCID=5</code>, the limit can be the
capacity block&#8217;s maximum capacity. For shared allocations, such as between
<code>RCID=3</code> and <code>RCID=6</code>, individual limits can be set. For example, if two
capacity blocks represent 100 units and <code>RCID=3</code> has a 30-unit limit while
<code>RCID=6</code> has a 70-unit limit, they can use 30% and 70% of the shared capacity
blocks, respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>The <code>FLUSH_RCID</code> operation can incur a long latency to complete. However, the
<code>RCID</code> can submit new requests to the controller while it is being flushed.
Additionally, the controller is allowed to deallocate capacity that was allocated
after the operation was initiated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For cache controllers, the <code>FLUSH_RCID</code> operation perfoms an operation
similar to that performed by the RISC-V <code>CBO.FLUSH</code> instruction on each cache
block that is part of the allocation configured for the <code>RCID</code>.</p>
</div>
<div class="paragraph">
<p>The <code>FLUSH_RCID</code> operation can be used as part of reclaiming a previously
allocated <code>RCID</code> and associating it with a new workload. When such a
reallocation is performed, the capacity controllers might have capacity allocated
by the old workload and thus for a short warm-up duration, the capacity controller
might be enforcing capacity allocation limits that reflect the usage by the old
workload. Such warm-up durations are typically not statistically significant, but
if that is not desired, then the <code>FLUSH_RCID</code> operation can be used to flush and
evict capacity allocated by the old workload.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the <code>cc_alloc_ctl</code> register is written, the controller might perform
several actions that might not complete synchronously with the write. A write to
the <code>cc_alloc_ctl</code> sets the read-only <code>BUSY</code> bit to 1, indicating the controller
is performing the requested operation. When the <code>BUSY</code> bit reads 0, the operation
is complete, and the read-only <code>STATUS</code> field provides a status value
(<a href="#CC_ALLOC_STS"><code>cc_alloc_ctl.STATUS</code> Field Encodings</a>) of the requested operation. Values that are written to the <code>BUSY</code> and
the <code>STATUS</code> fields are always ignored. An implementation that can complete the
operation synchronously with the write might hardwire the <code>BUSY</code> bit to 0. The
state of the <code>BUSY</code> bit, when not hardwired to 0, shall change only in response
to a write to the register. The <code>STATUS</code> field remains valid until a subsequent
write to the <code>cc_alloc_ctl</code> register.</p>
</div>
<table id="CC_ALLOC_STS" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. <code>cc_alloc_ctl.STATUS</code> Field Encodings</caption>
<colgroup>
<col style="width: 14.6341%;">
<col style="width: 85.3659%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>STATUS</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operation was successfully completed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid or unsupported operation (<code>OP</code>) requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>RCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An operation was requested for an invalid <code>AT</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An invalid <em>capacity block</em> mask was specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6-63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-127</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>BUSY</code> bit is set to 1, the behavior of writes to the <code>cc_alloc_ctl</code>
register, <code>cc_cunits</code> register, or to the <code>cc_block_mask</code> register is
<code>UNSPECIFIED</code>. Some implementations might ignore the second write and others might
perform the operation determined by the second write. To ensure proper operation,
software must verify that <code>BUSY</code> bit  is 0 before writing any of these registers.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_BMASK"><a class="anchor" href="#CC_BMASK"></a>Capacity Block Mask (<code>cc_block_mask</code>)</h3>
<div class="paragraph">
<p>The <code>cc_block_mask</code> is a WARL register. If the controller does not support
capacity allocation, for example, <code>NCBLKS</code> is 0, then this register is read-only 0.</p>
</div>
<div class="paragraph">
<p>The register has <code>NCBLKS</code> bits, each corresponding to one allocatable
<em>capacity block</em> in the controller. The width of this register is variable, but
always a multiple of 64 bits. The bitmap width in bits (<code>BMW</code>) is determined by
the following equation. The division operation in this equation is an integer
division.</p>
</div>
<div id="eq-2" class="stemblock">
<div class="content">
\[\begin{equation}
BMW = \lfloor{\frac{NCBLKS + 63}{64}}\rfloor \times 64
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>Bits <code>NCBLKS-1:0</code> are read-write, and the bits <code>BMW-1:NCBLKS</code> are read-only zero.</p>
</div>
<div class="paragraph">
<p>The process of configuring capacity allocation for an <code>RCID</code> and <code>AT</code> begins by
programming the <code>cc_block_mask</code> register with a bit-mask value that identifies the
<em>capacity blocks</em> to be allocated and, if supported, by programming the
<code>cc_cunits</code> register with a limit on the capacity units that might be occupied in
those capacity blocks. Next, the <code>cc_alloc_ctl register</code> is written to request a
<code>CONFIG_LIMIT</code> operation for the <code>RCID</code> and <code>AT</code>. After a capacity allocation
limit is established, a request can be allocated capacity in the <em>capacity
blocks</em> allocated to the <code>RCID</code> and <code>AT</code> associated with the request. It is
important to note that some implementations might require at least one <em>capacity
block</em> to be allocated by using <code>cc_block_mask</code> when allocating capacity;
otherwise, the operation fails with <code>STATUS=5</code>.  Overlapping <em>capacity block</em>
masks among <code>RCID</code> and/or <code>AT</code> are allowed to be configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A multiway set-associative cache controller that supports capacity allocation <em>by
ways</em> can advertise <code>NCBLKS</code> as the number of ways per set in the cache. To allocate
capacity in such a cache for an <code>RCID</code> and <code>AT</code>, a subset of ways must be
selected and a mask of the selected ways must be programmed in <code>cc_block_mask</code> field when
the <code>CONFIG_LIMIT</code> operation is requested.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To read the <em>capacity block</em> allocation for an <code>RCID</code> and <code>AT</code>, the controller
provides the <code>READ_LIMIT</code> operation, which can be requested by writing to the
<code>cc_alloc_ctl</code> register. When the operation completes successfully, the
<code>cc_block_mask</code> register holds the configured <em>capacity block</em> allocation.</p>
</div>
</div>
<div class="sect2">
<h3 id="CC_CUNITS"><a class="anchor" href="#CC_CUNITS"></a>Capacity Units</h3>
<div class="paragraph">
<p>The <code>cc_cunits</code> register is a read-write WARL register. If the controller does
not support capacity allocation (for example, <code>NCBLKS</code> is set to 0), this register
shall be read-only zero.</p>
</div>
<div class="paragraph">
<p>If the controller does not support configuring limits on <em>capacity units</em> that
may be occupied in the allocated <em>capacity blocks</em> (for example,
<code>cc_capabilities.CUNITS=0</code>), then this register shall be read-only zero. In such
cases, the controller allows the utilization of all available <em>capacity units</em> by
an <code>RCID</code> within the <em>capacity blocks</em> allocated to it.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>If the controller supports configuring limits on <em>capacity units</em> that might be
occupied in the allocated <em>capacity blocks</em> (for example, <code>cc_capabilities.CUNITS=1</code>)
then this register sets an upper limit on the number of <em>capacity units</em> that
can be occupied by an <code>RCID</code> in the <em>capacity blocks</em> allocated for an <code>AT</code>. A
value of zero specified in the <code>cc_cunits</code> register indicates that no limit is
configured.</p>
</div>
<div class="paragraph">
<p>The sum of the <code>cc_cunits</code> configured for the <code>RCID</code> sharing a <em>capacity block</em>
allocation may exceed the <em>capacity units</em> represented by that <em>capacity block</em>
allocation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When multiple <code>RCID</code> instances share a <em>capacity block</em> allocation, the
<code>cc_cunits</code> register can be employed to set an upper limit on the number of
<em>capacity units</em> each <code>RCID</code> can occupy.</p>
</div>
<div class="paragraph">
<p>For instance, consider a group of four <code>RCID</code> instances configured to share a
set of <em>capacity blocks</em>, representing a total of 100 capacity units. Each
<code>RCID</code> can be configured with a limit of 30 capacity units, ensuring that no
individual <code>RCID</code> exceeds 30% of the total shared <em>capacity units</em>.</p>
</div>
<div class="paragraph">
<p>The capacity controller might enforce these limits through various techniques.
Examples include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Refraining from allocating new capacity units to an <code>RCID</code> that reached
its limit.</p>
</li>
<li>
<p>Evicting previously allocated capacity units when a new allocation is
required.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These methods are not exhaustive and can be applied either individually or in
combination to maintain <em>capacity unit</em> limits.</p>
</div>
<div class="paragraph">
<p>When the limit on the <em>capacity units</em> is reached or is about to be reached,
the capacity controller can initiate additional operations. These could include
throttling certain activities (for example, prefetches) of the corresponding workload
requests.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To read the <em>capacity unit</em> limit for an <code>RCID</code> and <code>AT</code>, the controller
provides the <code>READ_LIMIT</code> operation that can be requested by writing to the
<code>cc_alloc_ctl</code> register. When the operation completes successfully, the
<code>cc_cunits</code> register holds the configured <em>capacity unit</em> allocation limit.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="qos_identifiers.html">QoS Identifiers</a></span>
  <span class="next"><a href="qos_bandwidth.html">Bandwidth-controller QoS Register Interface</a></span>
</nav>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../../ffh/v1.0/index.html">ACPI Functional Fixed Hardware</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../ffh/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../aia/v1.0/index.html">Advanced Interrupt Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../aia/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../etrace/v1.0/index.html">E-Trace Encapsulation Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../etrace/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../psabi/v1.0/index.html">ELF psABI Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../psabi/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../iommuArch/v1.0/index.html">IOMMU Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../iommuArch/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../isa/index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../isa/index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../reri/v1.0/index.html">RERI Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../reri/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../plic/v1.0.0/index.html">RISC-V Platform-Level Interrupt Controller</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../plic/v1.0.0/index.html">
      v1.0.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../semihost/v1.0/index.html">semihosting</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../semihost/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
