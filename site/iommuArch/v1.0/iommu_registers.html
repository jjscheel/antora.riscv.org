<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V Ratified Specifications Library</title>
    <link rel="prev" href="iommu_debug.html">
    <link rel="next" href="iommu_sw_guidelines.html">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="3f4ce2c51445edcfc62ee1f59ab97fffc218fb79"> 
    <meta name="version" content="v1.0">
    <meta name="component" content="iommuArch">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">RISC-V Ratified Specifications Library</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="iommuArch" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">IOMMU Architecture</span>
  <span class="version">v1.0</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IOMMU Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="contributors.html">Contributors</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_preface.html">Preface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_data_structures.html">Data Structures</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_in_memory_queues.html">In-memory queue interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_debug.html">Debug support</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link"  href="iommu_registers.html">Memory-mapped register interface</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_sw_guidelines.html">Software guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_hw_guidelines.html">Hardware guidelines</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="iommu_extensions.html">IOMMU Extensions</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/riscv-non-isa/riscv-iommu/edit/antora-refactor/modules/ROOT/pages/iommu_registers.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/riscv-non-isa/riscv-iommu" title="GitHub">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>

      <a href="" title="PDF">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          Download PDF
        </a>
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li>IOMMU Architecture</li>
      <li><a href="iommu_registers.html">Memory-mapped register interface</a></li>
    </ul>
  </nav>
</div><div class="sect1">
<h2 id="memory-mapped-register-interface"><a class="anchor" href="#memory-mapped-register-interface"></a>Memory-mapped register interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The IOMMU provides a memory-mapped programming interface. The memory-mapped
registers of each IOMMU are located within a naturally aligned 4-KiB region
(a page) of physical address space.</p>
</div>
<div class="paragraph">
<p>The IOMMU behavior for register accesses where the address is not aligned to
the size of the access, or if the access spans multiple registers, or if the
size of the access is not 4 bytes or 8 bytes, is <code>UNSPECIFIED</code>. A 4 byte access
to an IOMMU register must be single-copy atomic. Whether an 8 byte access to an
IOMMU register is single-copy atomic is <code>UNSPECIFIED</code>, and such an access may
appear, internally to the IOMMU, as if two separate 4 byte accesses&#8201;&#8212;&#8201;first to
the high half and second to the low half&#8201;&#8212;&#8201;were performed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The 8-byte IOMMU registers are defined in such a way that software can perform
two individual 4-byte accesses, or hardware can perform two independent 4-byte
transactions resulting from an 8-byte access, to the high and low halves of the
register, in that order, as long as the register semantics, with regard to side-effects, are
respected between the two software accesses, or two hardware transactions,
respectively.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The IOMMU registers have little-endian byte order, even for systems where
all harts are big-endian-only.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Big-endian-configured harts that make use of an IOMMU are expected to implement
the <code>REV8</code> byte-reversal instruction defined by the Zbb extension. If <code>REV8</code> is
not implemented, then endianness conversion may be implemented using a sequence
of instructions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a register is optional, as determined by the corresponding <code>capabilities</code>
register bit being 0, then a read from the memory-mapped register offset of
the register returns 0 and writes to that offset are ignored.</p>
</div>
<div class="sect2">
<h3 id="register-layout"><a class="anchor" href="#register-layout"></a>Register layout</h3>
<table class="tableblock frame-all grid-all fit-content center">
<caption class="title">Table 1. IOMMU Memory-mapped register layout</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Offset</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size</th>
<th class="tableblock halign-center valign-top">Description</th>
<th class="tableblock halign-center valign-top">Is Optional?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>capabilities</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CAP">Capabilities of the
                                     IOMMU</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#FCTRL">Features control</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated For custom use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ddtp</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#DDTP">Device directory
                              table pointer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cqb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CQB">Command-queue base</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cqh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CQH">Command-queue head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cqt</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CQT">Command-queue tail</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#FQB">Fault-queue base</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#FQH">Fault-queue head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">52</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqt</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#FQT">Fault-queue tail</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqb</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#PQB">Page-request-queue
                                     base</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.ATS==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#PQH">Page-request-queue
                                     head</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.ATS==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqt</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#PQT">Page-request-queue
                                     tail</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.ATS==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cqcsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CSR">Command-queue CSR</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">76</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqcsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#FQCSR">Fault-queue CSR</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqcsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#PQCSR">Page-request-queue
                                       CSR </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.ATS==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ipsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#IPSR">Interrupt pending
                                         status register</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">88</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iocountovf</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#OVF">HPM counter
                                              overflows</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.HPM==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">92</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iocountinh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#INH">HPM counter
                                               inhibits</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.HPM==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iohpmcycles</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CYC">HPM cycles counter</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.HPM==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iohpmctr1-31</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">248</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#CTR">HPM event counters</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.HPM==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">352</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iohpmevt1-31</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">248</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#EVT">HPM event selector</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.HPM==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tr_req_iova</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TRR_IOVA">Translation-request
                                     IOVA</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.DBG==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">608</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tr_req_ctl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TRR_CTRL">Translation-request
                                     control</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.DBG==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">616</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tr_response</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#TRR_RSP">Translation-request
                                     response</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.DBG==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">624</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iommu_qosid</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#IOQOSID">IOMMU QoS ID </a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.QOSID==0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">628</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for future use
                              (<code>WPRI</code>)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">688</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use
                              (<code>WARL</code>)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">760</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>icvec</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ICVEC">Interrupt cause
                              to vector register</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">768</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msi_cfg_tbl</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#MSI">MSI Configuration
                                     Table</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if <code>capabilities.IGS==WSI</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3072</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="reset-behavior"><a class="anchor" href="#reset-behavior"></a>Reset behavior</h3>
<div class="paragraph">
<p>The reset value is 0 for the following registers fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cqcsr</code> - <code>cqen</code>, <code>cqie</code>, <code>cqon</code>, and <code>busy</code></p>
</li>
<li>
<p><code>fqcsr</code> - <code>fqen</code>, <code>fqie</code>, <code>fqon</code>, and <code>busy</code></p>
</li>
<li>
<p><code>pqcsr</code> - <code>pqen</code>, <code>pqie</code>, <code>pqon</code>, and <code>busy</code></p>
</li>
<li>
<p><code>tr_req_ctl.Go/Busy</code></p>
</li>
<li>
<p><code>ddtp.busy</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reset value is 0 for the following registers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ipsr</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Reset value for <code>ddtp.iommu_mode</code> field must be either <code>Off</code> or <code>Bare</code>.</p>
</div>
<div class="paragraph">
<p>After a reset the caches (<a href="#CACHING">[CACHING]</a>) must have no valid entries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The reset value for the <code>iommu_mode</code> is recommended to be <code>Off</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The reset value is <code>UNSPECIFIED</code> for all other registers and/or fields.</p>
</div>
</div>
<div class="sect2">
<h3 id="CAP"><a class="anchor" href="#CAP"></a>IOMMU capabilities (<code>capabilities</code>)</h3>
<div class="paragraph">
<p>The <code>capabilities</code> register is a read-only register reporting features supported
by the IOMMU. Each field if not clear indicates the presence of that feature in
the IOMMU. At reset, the register shall contain the IOMMU supported features.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqF00ELgjAYBuB7v2K3Lh5yWdpuC8uELEuhQ0SYrRJSw5kE4n-PCAwP77ru2ffyso_Vhbgysu8RUp-SUjJiaSSLUsFIvxKFTPKs32g_1VsNqiHFNIFkWJBGZoeGLRVCiqISZzj5OKWloufLUDRVoGEpcGRC_NOXe-ujt3XngL3APc6XPFSwYvoTvthxG3EYAAmp43Ngs1U3j7biOihv4XtA7KnTkXErPkdpvm1B0U1IdABosw5c9EarJVp695yqF_77SfFTlnn6wYNG4jy7JFdW36NMfG_d5COKBdMH1GiaNyX2A7s=" alt="IOMMU capabilities register fields">
</div>
<div class="title">Figure 1. IOMMU capabilities register fields</div>
</div>
<table class="tableblock frame-all grid-all fit-content center">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>version</code> field holds the version of the
                                specification implemented by the IOMMU. The low
                                nibble is used to hold the minor version of the
                                specification and the upper nibble is used to
                                hold the major version of the specification.
                                For example, an implementation that supports
                                version 1.0 of the specification reports 0x10.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv32</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 32-bit virtual addressing is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv39</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 39-bit virtual addressing is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv48</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 48-bit virtual addressing is supported.<br>
                                When <code>Sv48</code> is set, <code>Sv39</code> must be set.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv57</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 57-bit virtual addressing is supported<br>
                                When <code>Sv57</code> is set, <code>Sv48</code> must be set.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Svpbmt</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based memory types.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv32x4</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 34-bit virtual addressing for
                                second-stage address translation is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv39x4</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 41-bit virtual addressing for
                                second-stage address translation is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv48x4</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 50-bit virtual addressing for
                                second-stage address translation is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sv57x4</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page-based 59-bit virtual addressing for
                                second-stage address translation is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AMO_MRIF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic updates to MRIF is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MSI_FLAT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSI address translation using Pass-through
                                mode MSI PTE is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MSI_MRIF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSI address translation using MRIF mode MSI PTE
                                is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AMO_HWAD</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atomic updates to PTE accessed (A)
                                and dirty (D) bit is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ATS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCIe Address Translation Services (ATS) and
                                page-request interface (PRI) cite:[PCI] is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>T2GPA</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returning guest-physical-address in ATS
                                translation completions is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>END</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When 0, IOMMU supports one endianness (either little
                                or big). When 1, IOMMU supports both endianness.
                                The endianness is defined in the <code>fctl</code> register.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">29:28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IGS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IOMMU interrupt generation support.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Value</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IOMMU supports only message-
                                                     signaled-interrupt generation.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IOMMU supports only wire-
                                                     signaled-interrupt generation.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IOMMU supports both MSI
                                                     and WSI generation.
                                                     The interrupt generation method
                                                     must be defined in the <code>fctl</code>
                                                     register.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IOMMU implements a hardware performance monitor.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DBG</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IOMMU supports the translation-request interface</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">37:32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PAS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical Address Size supported by the IOMMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">38</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PD8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One level PDT with 8-bit process_id supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">39</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PD17</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two level PDT with 17-bit process_id supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PD20</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Three level PDT with 20-bit process_id supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>QOSID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associating QoS IDs with requests is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-leaf PTE invalidation extension is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>S</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address range invalidation extension is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">55:44</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When <code>HPM</code> is 1, the <code>iohpmcycles</code> and the <code>iohpmctr1</code> registers must be present
and be at least 32-bits wide.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p>At least one method, <code>MSI</code> or <code>WSI</code>, of generating interrupts from the IOMMU
must be supported.</p>
</div>
<div class="paragraph">
<p>IOMMU implementations must support the Svnapot standard extension for NAPOT
Translation Contiguity.</p>
</div>
<div class="paragraph">
<p>The physical address space addressable by the IOMMU ranges from 0 to
\$2^{capabilities.PAS} - 1\$.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hypervisor may provide an SW emulated IOMMU to allow the guest to manage
the first-stage page tables for fine grained control on memory accessed by guest
controlled devices.</p>
</div>
<div class="paragraph">
<p>A hypervisor that provides such an emulated IOMMU to the guest may retain
control of the second-stage address translation and clear the <code>SvNx4</code> fields of
the emulated <code>capabilities</code> register.</p>
</div>
<div class="paragraph">
<p>A hypervisor that provides such an emulated IOMMU to the guest may retain
control of the MSI page tables used to direct MSIs to guest interrupt files in
an IMSIC or to a memory-resident-interrupt-file and clear the <code>MSI_FLAT</code> and
<code>MSI_MRIF</code> fields of the emulated <code>capabilities</code> register.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>AMO_HWAD</code>/<code>AMO_MRIF</code> bits do not indicate support for device-initiated atomic memory
operations. Support for device-initiated atomic memory operations must be
discovered through other means.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The IOMMU is designed to provide a highly modular and extensible set of
capabilities allowing implementations to include only the exact set of
capabilities required for an application. In addition, implementations may add
their own custom extensions to the IOMMU.</p>
</div>
<div class="paragraph">
<p>The IOMMU must support all the virtual memory extensions that are supported
by any of the harts in the system.</p>
</div>
<div class="paragraph">
<p>RISC-V platform specifications may mandate a set of IOMMU capabilities
that must be provided by an implementation to be compliant to those
specifications.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="FCTRL"><a class="anchor" href="#FCTRL"></a>Features-control register (<code>fctl</code>)</h3>
<div class="paragraph">
<p>This register must be readable in any implementation. An implementation may
allow one or more fields in the register to be writable to support enabling
or disabling the feature controlled by that field.</p>
</div>
<div class="paragraph">
<p>If software enables or disables a feature when the IOMMU is not OFF
(i.e. when <code>ddtp.iommu_mode != Off</code>) then the IOMMU behavior is <code>UNSPECIFIED</code>.</p>
</div>
<div class="paragraph">
<p>If software enables or disables a feature when the IOMMU in-memory queues
are enabled (i.e. <code>cqcsr.cqon/cqen == 1</code>, <code>fqcsr.fqon/cqen == 1</code>, or
<code>pqcsr.pqon/pqen == 1</code>) then the IOMMU behavior is <code>UNSPECIFIED</code>.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDUUchLzE21UlB3clWv1cEmER7siUPGPcIHVcZYRwEmV5RanFpUlpqCqsAMoSC5tLgkPxckHaujkJyfl5aZblWdk5iXCrEio7ggMTnVytDAyKS2FgDYHzXv" alt="Feature-control register fields">
</div>
<div class="title">Figure 2. Feature-control register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When 0, IOMMU accesses to memory resident data
                                structures, as specified in <a href="#ENDIAN_CONFIG">[ENDIAN_CONFIG]</a>,
                                and accesses to in-memory queues are performed
                                as little-endian accesses and when 1 as
                                big-endian accesses.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WSI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When 1, IOMMU interrupts are signaled as
                                wire-signaled-interrupts else they are signaled
                                as message-signaled-interrupts.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GXL</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the address-translation schemes that
                                may be used for guest physical addresses as
                                defined in <a href="#IOHGATP_MODE_ENC">[IOHGATP_MODE_ENC]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="DDTP"><a class="anchor" href="#DDTP"></a>Device-directory-table pointer (<code>ddtp</code>)</h3>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDRUVDIS8xNtVJQz8zPzS2Nz81PSVWv1UGoMESoSCotrkSRM9WBSRWlFqcWlaWmoEibmMDlAwL8UE01wKo1VkchOT8vLTPdqjonMS8V4sCM4oLE5FQrQwMjk9paAFsMOzM=" alt="Device-directory-table pointer register fields">
</div>
<div class="title">Figure 3. Device-directory-table pointer register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iommu_mode</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The IOMMU may be configured to be in the following
                                modes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Value</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Off</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No inbound memory
                                                     transactions are allowed
                                                     by the IOMMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Bare</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No translation or
                                                     protection. All inbound
                                                     memory accesses are passed
                                                     through.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1LVL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One-level
                                                     device-directory-table</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2LVL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two-level
                                                     device-directory-table</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3LVL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Three-level
                                                     device-directory-table</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5-13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A write to <code>ddtp.iommu_mode</code> may require the IOMMU to
                                perform many operations that may not occur
                                synchronously to the write. When a write is
                                observed by the <code>ddtp.iommu_mode</code>, the <code>busy</code> bit is set
                                to 1. When the <code>busy</code> bit is 1, behavior of
                                additional writes to the <code>ddtp</code> is
                                <code>UNSPECIFIED</code>. Some implementations
                                may ignore the second write and others may
                                perform the actions determined by the second
                                write. Software must verify that the <code>busy</code>
                                bit is 0 before writing to the <code>ddtp</code>.<br>
                                                                              <br>
                                If the <code>busy</code> bit reads 0 then the IOMMU has
                                completed the operations associated with the
                                previous write to <code>ddtp.iommu_mode</code>.<br>
                                                                              <br>
                                An IOMMU that can complete these operations
                                synchronously may hard-wire this bit to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9:5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">53:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PPN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>PPN</code> of the root page of the
                                device-directory-table.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:54</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The device-context is 64-bytes in size if <code>capabilities.MSI_FLAT</code> is 1 else it is
32-bytes.</p>
</div>
<div class="paragraph">
<p>When the <code>iommu_mode</code> is <code>Bare</code> or <code>Off</code>, the <code>PPN</code> field is don&#8217;t-care. When
in <code>Bare</code> mode only Untranslated requests are allowed. Translated requests,
Translation request, and PCIe message transactions are unsupported.</p>
</div>
<div class="paragraph">
<p>All IOMMUs must support <code>Off</code> and <code>Bare</code> mode. An IOMMU is allowed to support a
subset of directory-table levels and device-context widths. At a minimum one
of the modes must be supported.</p>
</div>
<div class="paragraph">
<p>When the <code>iommu_mode</code> field value is changed to <code>Off</code> the IOMMU guarantees that
in-flight transactions, observed at the time of the write to this field, from devices
connected to the IOMMU will either be processed with the configurations
applicable to the old value of the <code>iommu_mode</code> field or be aborted
(<a href="#IOBR_FAULT_RESP">[IOBR_FAULT_RESP]</a>). It also ensures that all transactions and previous
requests from devices that have already been processed by the IOMMU are committed
to a global ordering point such that they can be observed by all RISC-V harts,
devices, and IOMMUs in the platform. Software must not change the <code>PPN</code> field
value when transitioning the <code>iommu_mode</code> to <code>Off</code>.</p>
</div>
<div class="paragraph">
<p>The IOMMU behavior of writing <code>iommu_mode</code> to <code>1LVL</code>, <code>2LVL</code>, or <code>3LVL</code>, when
the previous value of the <code>iommu_mode</code> is not <code>Off</code> or <code>Bare</code> is <code>UNSPECIFIED</code>.
To change DDT levels, the IOMMU must first be transitioned to <code>Bare</code> or <code>Off</code>
state. The behavior resulting from changing the <code>iommu_mode</code> to <code>Bare</code> when the
previous value of the <code>iommu_mode</code> was not <code>Off</code> is <code>UNSPECIFIED</code>.</p>
</div>
<div class="paragraph">
<p>When an IOMMU is transitioned to <code>Bare</code> or <code>Off</code> state, the IOMMU may retain
information cached from in-memory data structures such as page tables, DDT,
PDT, etc. Software must use suitable invalidation commands to invalidate cached
entries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In RV32, only the low order 32-bits of the register (22-bit <code>PPN</code> and
4-bit <code>iommu_mode</code>) need to be written.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="CQB"><a class="anchor" href="#CQB"></a>Command-queue base (<code>cqb</code>)</h3>
<div class="paragraph">
<p>This 64-bit register (RW) holds the PPN of the root page of the command-queue
and number of entries in the queue. Each command is 16 bytes.</p>
</div>
<div class="paragraph">
<p>The IOMMU behavior on writing <code>cqb</code> when <code>cqcsr.busy</code> or <code>cqon</code> bits are 1 is
<code>UNSPECIFIED</code>. The software recommended sequence to change <code>cqb</code> is to first
disable the command-queue by clearing <code>cqen</code> and wait for both <code>cqcsr.busy</code> and
<code>cqon</code> to be 0 before changing the <code>cqb</code>. The status of bits <code>31:cqb.LOG2SZ</code> in
<code>cqt</code> following a write to <code>cqb</code> is 0 and the bits <code>cqb.LOG2SZ-1:0</code> in <code>cqt</code>
assume a valid but otherwise <code>UNSPECIFIED</code> value.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1VHIS8xNtVJQ9_F3NwqO0jVUr9VByCOki1KLU4vKUlNQpE1M4PIBAX4oUoYGWLXG6igk5-elZaZbVeck5qUCFRrpKGQUFyQmp1oZGhiZ1NYCAGQEMQM=" alt="Command-queue base register fields">
</div>
<div class="title">Figure 4. Command-queue base register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG2SZ-1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>LOG2SZ-1</code> field holds the number of
                                entries in command-queue as a log to base 2
                                minus 1.
                                A value of 0 indicates a queue of 2 entries.
                                Each IOMMU command is 16-bytes.
                                If the command-queue has 256 or fewer entries
                                then the base address of the queue is always
                                aligned to 4-KiB. If the command-queue has more
                                than 256 entries then the command-queue
                                base address must be naturally aligned to
                                <code>2<sup>LOG2SZ</sup> x 16</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9:5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">53:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PPN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>PPN</code> of the root page of the
                                in-memory command-queue used by software to
                                queue commands to the IOMMU. If the base
                                address as determined by <code>PPN</code> is not aligned
                                as required, all entries in the queue appear
                                to an IOMMU as <code>UNSPECIFIED</code> and any address
                                an IOMMU may compute and use for accessing an
                                entry in the queue is also <code>UNSPECIFIED</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:54</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In RV32, only the low order 32-bits of the register (22-bit <code>PPN</code> and
5-bit <code>LOG2SZ-1</code>) need to be written.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="CQH"><a class="anchor" href="#CQH"></a>Command-queue head (<code>cqh</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RO) holds the index into the command-queue where
the IOMMU will fetch the next command.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA20lHIS8xNtVJQz8xLSa1Qr9XhitVRSM7PS8tMt6rOScxLBaoy1FHIKC5ITE61MjQwMqmtBQATKxYy" alt="Command-queue head register fields">
</div>
<div class="title">Figure 5. Command-queue head register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>index</code> into the command-queue from where
                            the next command will be fetched by the IOMMU.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="CQT"><a class="anchor" href="#CQT"></a>Command-queue tail (<code>cqt</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RW) holds the index into the command-queue where
the software queues the next command for the IOMMU.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA20lHIS8xNtVJQz8xLSa1Qr9XhitVRSM7PS8tMt6rOScxLBaoy1FHIKC5ITE61MjQwMqmtBQATKxYy" alt="Command-queue tail register fields">
</div>
<div class="title">Figure 6. Command-queue tail register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>index</code> into the command-queue where
                            software queues the next command for IOMMU.  Only
                            <code>LOG2SZ-1:0</code> bits are writable.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="FQB"><a class="anchor" href="#FQB"></a>Fault queue base (<code>fqb</code>)</h3>
<div class="paragraph">
<p>This 64-bit register (RW) holds the PPN of the root page of the fault-queue
and number of entries in the queue. Each fault record is 32 bytes.</p>
</div>
<div class="paragraph">
<p>The IOMMU behavior on writing <code>fqb</code> when <code>fqcsr.busy</code> or <code>fqon</code> bits are 1 is
<code>UNSPECIFIED</code>. The software recommended sequence to change <code>fqb</code> is to first
disable the fault-queue by clearing <code>fqen</code> and wait for both <code>fqcsr.busy</code> and
<code>fqon</code> to be 0 before changing the <code>fqb</code>. The status of bits <code>31:fqb.LOG2SZ</code>
in <code>fqh</code> following a write to <code>fqb</code> is 0 and the bits <code>fqb.LOG2SZ-1:0</code> in <code>fqh</code>
assume a valid but otherwise <code>UNSPECIFIED</code> value.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDVUchLzE21UlD38Xc3Co7SNVSv1cEmXZRanFpUlpqCIm1iApcPCPBDkTI0wKo1VkchOT8vLTPdqjonMS8VqNBIRyGjuCAxOdXK0MDIpLYWAExkMOM=" alt="Fault queue base register fields">
</div>
<div class="title">Figure 7. Fault queue base register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG2SZ-1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>LOG2SZ-1</code> field holds the number of
                               entries in the fault-queue as a log-to-base-2
                               minus 1. A value of 0 indicates a queue of 2
                               entries. Each fault record is 32-bytes.
                               If the fault-queue has 128 or fewer entries then
                               the base address of the queue is always aligned
                               to 4-KiB. If the fault-queue has more than 128
                               entries then the fault-queue base address must
                               be naturally aligned to <code>2<sup>LOG2SZ</sup> x 32</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9:5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">53:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PPN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>PPN</code> of the root page of the
                               in-memory fault-queue used by IOMMU to queue
                               fault record. If the base address as determined
                               by <code>PPN</code> is not aligned as required, all entries
                               in the queue appear to an IOMMU as <code>UNSPECIFIED</code>
                               and any address an IOMMU may compute and use for
                               accessing an entry in the queue is also
                               <code>UNSPECIFIED</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:54</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In RV32, only the low order 32-bits of the register (22-bit <code>PPN</code> and
5-bit <code>LOG2SZ-1</code>) need to be written.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="FQH"><a class="anchor" href="#FQH"></a>Fault queue head (<code>fqh</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RW) holds the index into the fault-queue where the
software will fetch the next fault record.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA20lHIS8xNtVJQz8xLSa1Qr9XhitVRSM7PS8tMt6rOScxLBaoy1FHIKC5ITE61MjQwMqmtBQATKxYy" alt="Fault queue head register fields">
</div>
<div class="title">Figure 8. Fault queue head register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>index</code> into the fault-queue from which
                            software reads the next fault record.  Only
                            <code>LOG2SZ-1:0</code> bits are writable.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="FQT"><a class="anchor" href="#FQT"></a>Fault queue tail (<code>fqt</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RO) holds the index into the fault-queue where the
IOMMU queues the next fault record.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA20lHIS8xNtVJQz8xLSa1Qr9XhitVRSM7PS8tMt6rOScxLBaoy1FHIKC5ITE61MjQwMqmtBQATKxYy" alt="Fault queue tail register fields">
</div>
<div class="title">Figure 9. Fault queue tail register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>index</code> into the fault-queue where IOMMU
                            writes the next fault record.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="PQB"><a class="anchor" href="#PQB"></a>Page-request-queue base (<code>pqb</code>)</h3>
<div class="paragraph">
<p>This 64-bit register (WARL) holds the PPN of the root page of the
page-request-queue and number of entries in the queue. Each "Page Request"
message is 16 bytes.</p>
</div>
<div class="paragraph">
<p>The IOMMU behavior on writing <code>pqb</code> when <code>pqcsr.busy</code> or <code>pqon</code> bits are 1 is
<code>UNSPECIFIED</code>. The software recommended sequence to change <code>pqb</code> is to first
disable the page-request-queue by clearing <code>pqen</code> and wait for both <code>pqcsr.busy</code>
and <code>pqon</code> to be 0 before changing the <code>pqb</code>. The status of bits <code>31:pqb.LOG2SZ</code>
in <code>pqh</code> following a write to <code>pqb</code> is 0 and the bits <code>pqb.LOG2SZ-1:0</code> in <code>pqh</code>
assume a valid but otherwise <code>UNSPECIFIED</code> value.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDVUchLzE21UlD38Xc3Co7SNVSv1UFII8kXpRanFpWlpqDIm5jA5QMC_FCkDA2wao3VUUjOz0vLTLeqzknMSwUqNNJRyCguSExOtTI0MDKprQUAaIcxAw==" alt="Page-Request-queue base register fields">
</div>
<div class="title">Figure 10. Page-Request-queue base register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG2SZ-1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>LOG2SZ-1</code> field holds the number of entries
                               in the page-request-queue as a log-to-base-2 minus 1.
                               A value of 0 indicates a queue of 2 entries.
                               Each page-request is 16-bytes. If the
                               page-request-queue has 256 or fewer entries
                               then the base address of the queue is always
                               aligned to 4-KiB.
                               If the page-request-queue has more than 256
                               entries then the page-request-queue base address
                               must be naturally aligned to <code>2<sup>LOG2SZ</sup> x 16</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9:5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">53:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PPN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>PPN</code> of the root page of the
                               in-memory page-request-queue used by IOMMU to
                               queue "Page Request" messages. If the base
                               address as determined by <code>PPN</code> is not aligned as
                               required, all entries in the queue appear to an
                               IOMMU as <code>UNSPECIFIED</code> and any address an IOMMU
                               may compute and use for accessing an entry in the
                               queue is also <code>UNSPECIFIED</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:54</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In RV32, only the low order 32-bits of the register (22-bit <code>PPN</code> and
5-bit <code>LOG2SZ-1</code>) need to be written.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="PQH"><a class="anchor" href="#PQH"></a>Page-request-queue head (<code>pqh</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RW) holds the index into the page-request-queue where
software will fetch the next page-request.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA20lHIS8xNtVJQz8xLSa1Qr9XhitVRSM7PS8tMt6rOScxLBaoy1FHIKC5ITE61MjQwMqmtBQATKxYy" alt="Page-request-queue head register fields">
</div>
<div class="title">Figure 11. Page-request-queue head register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>index</code> into the page-request-queue from
                            which software reads the next "Page Request" message.
                            Only <code>LOG2SZ-1:0</code> bits are writable.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="PQT"><a class="anchor" href="#PQT"></a>Page-request-queue tail (<code>pqt</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RO) holds the index into the page-request-queue
where the IOMMU writes the next page-request.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA20lHIS8xNtVJQz8xLSa1Qr9XhitVRSM7PS8tMt6rOScxLBaoy1FHIKC5ITE61MjQwMqmtBQATKxYy" alt="Page-request-queue tail register fields">
</div>
<div class="title">Figure 12. Page-request-queue tail register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the <code>index</code> into the page-request-queue
                            where IOMMU writes the next "Page Request" message.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="CSR"><a class="anchor" href="#CSR"></a>Command-queue CSR (<code>cqcsr</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RW) is used to control the operations and report the
status of the command-queue.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqNz00KwyAQBeB9TzG7bFwkJWThVUoRY8ZU8CdR01LEu5dQaBFq6Pp782YmeZwpXE4AaVQxUOgIWG6QQiNWtE0mP0lhIcNHPAb0d5xqg6uRNTITi-4AldYVlWgFsgdTSxHo_7_K1T4dt_AsqT1u_S4VW4jO7HglIJyVaqZJc4vv1C0sXCDt2nOf8wsKInbr" alt="Command-queue CSR register fields">
</div>
<div class="title">Figure 13. Command-queue CSR register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cqen</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command-queue-enable bit enables the command-
                            queue when set to 1.<br>
                                                                             <br>
                            Changing <code>cqen</code> from 0 to 1 sets the <code>cqh</code>
                            register and the <code>cqcsr</code> bits <code>cmd_ill</code>,<code>cmd_to</code>,
                            <code>cqmf</code>, <code>fence_w_ip</code> to 0. The command-queue may
                            take some time to be active following setting the
                            <code>cqen</code> to 1. During this delay the <code>busy</code> bit is 1.
                            When the command queue is active, the <code>cqon</code> bit
                            reads 1. <br>
                                                                             <br>
                            When <code>cqen</code> is changed from 1 to 0, the command
                            queue may stay active (with <code>busy</code> asserted) until
                            the commands already fetched from the command-queue
                            are being processed and/or there are outstanding
                            implicit loads from the command-queue.  When the
                            command-queue turns off the <code>cqon</code> bit reads 0.
                                                                             <br>
                            When the <code>cqon</code> bit reads 0, the IOMMU guarantees
                            that no implicit memory accesses to the command
                            queue are in-flight and the command-queue will not
                            generate new implicit loads to the queue memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cie</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command-queue-interrupt-enable bit enables
                            generation of interrupts from command-queue when
                            set to 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cqmf</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If command-queue access to fetch a command or a
                            memory access made by a command leads to a memory
                            fault, then the command-queue-memory-fault bit is set
                            to 1, and the command-queue stalls until this bit is
                            cleared. To re-enable command processing, software
                            should clear this bit by writing 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmd_to</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the execution of a command leads to a
                            timeout (e.g. a command to invalidate device ATC
                            may timeout waiting for a completion), then the
                            command-queue sets the <code>cmd_to</code> bit and stops
                            processing from the command-queue. To re-enable
                            command processing, software should clear this bit
                            by writing 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmd_ill</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If an illegal or unsupported command is fetched and
                            decoded by the command-queue then the command-queue
                            sets the <code>cmd_ill</code> bit and stops processing from the
                            command-queue. To re-enable command processing
                            software should clear this bit by writing 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence_w_ip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An IOMMU that supports wire-signaled-interrupts
                            sets the <code>fence_w_ip</code> bit to indicate completion
                            of an <code>IOFENCE.C</code> command.
                            To re-enable interrupts on <code>IOFENCE.C</code> completion,
                            software should clear this bit by writing 1.
                            This bit is reserved if the IOMMU does not support
                            wire-signaled-interrupts or wire-signaled-interrupts
                            are not enabled (i.e., <code>fctl.WSI == 0</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cqon</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command-queue is active if <code>cqon</code> is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A write to <code>cqcsr</code> may require the IOMMU to perform
                            many operations that may not occur synchronously
                            to the write. When a write is observed by the
                            <code>cqcsr</code>, the <code>busy</code> bit is set to 1.<br>
                                                                              <br>
                            When the <code>busy</code> bit is 1, behavior of additional
                            writes to the <code>cqcsr</code> is <code>UNSPECIFIED</code>.
                            Some implementations may ignore the second write and
                            others may perform the actions determined by the
                            second write.<br>
                                                                              <br>
                            Software must verify that the busy bit is 0 before
                            writing to the <code>cqcsr</code>.<br>
                                                                              <br>
                            An IOMMU that can complete these operations
                            synchronously may hard-wire this bit to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When <code>cmd_ill</code> or <code>cqmf</code> is 1 in <code>cqcsr</code>, the <code>cqh</code> references the command in the
CQ that caused the error. Previous commands may have completed, timed out, or
their execution aborted by the IOMMU.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If software makes the CQ operational again after a <code>cmd_ill</code> or <code>cqmf</code> error,
then software should resubmit the commands submitted since the last <code>IOFENCE.C</code>
that successfully completed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>cmd_to</code> bit is set when a <code>IOFENCE.C</code> command detects that one or more
previous commands that are specified to have timeouts have timed out but all
other commands previous to the <code>IOFENCE.C</code> have completed. When <code>cmd_to</code> is 1,
<code>cqh</code> references the <code>IOFENCE.C</code> command that detected the timeout.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Command-queue being empty does not imply that all commands fetched from the
command-queue have been completed. When the command-queue is requested to be
disabled, an implementation may either complete the already fetched commands
or abort execution of those commands. Software must use an <code>IOFENCE.C</code> command
to wait for all previous commands to be committed, if so desired, before
turning off the command-queue.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="FQCSR"><a class="anchor" href="#FQCSR"></a>Fault queue CSR (<code>fqcsr</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RW) is used to control the operations and report the
status of the fault-queue.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDUUchLzE21UlBPK0zNU6_VwSqVmYoiYwaXKUotTi0qS03BpbEwNw2nVH4auYbm43JoUmlxJaqUAX5TTeDSyaXFJfm5IMlYHYXk_Ly0zHSr6pzEvFSIqozigsTkVCtDAyOT2loATzNizA==" alt="Fault queue CSR register fields">
</div>
<div class="title">Figure 14. Fault queue CSR register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqen</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fault-queue enable bit enables the fault-queue
                           when set to 1.<br>
                                                                              <br>
                           Changing <code>fqen</code> from 0 to 1 sets the <code>fqt</code>
                           register and the <code>fqcsr</code> bits <code>fqof</code> and <code>fqmf</code>
                           to 0. The fault-queue may take some time to be active
                           following setting the <code>fqen</code> to 1. During this delay
                           the <code>busy</code> bit is 1. When the fault queue is active,
                           the <code>fqon</code> bit reads 1.<br>
                                                                              <br>
                           When <code>fqen</code> is changed from 1 to 0, the fault-queue
                           may stay active (with <code>busy</code> asserted) until in-flight
                           fault-recording is completed. When the fault-queue is
                           off the <code>fqon</code> bit reads 0.
                                                                              <br>
                           When <code>fqon</code> reads 0, the IOMMU guarantees that there
                           are no in-flight implicit writes to the fault-queue
                           in progress and that no new fault records will be
                           written to the fault-queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fie</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault queue interrupt enable bit enables generation
                           of interrupts from fault-queue when set to 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqmf</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>fqmf</code> bit is set to 1 if the IOMMU encounters
                           an access fault when storing a fault record to the
                           fault queue. The fault-record that was attempted to
                           be written is discarded and no more fault records
                           are generated until software clears the <code>fqmf</code> bit by
                           writing 1 to the bit.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqof</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fault-queue-overflow bit is set to 1 if the
                           IOMMU needs to queue a fault record but the
                           fault-queue is full (i.e., <code>fqt == fqh - 1</code>).<br>
                                                                              <br>
                           The fault-record is discarded and no more fault
                           records are generated until software clears <code>fqof</code>
                           by writing 1 to the bit.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reserved</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fqon</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fault-queue is active if <code>fqon</code> reads 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write to <code>fqcsr</code> may require the IOMMU to perform
                           many operations that may not occur synchronously to
                           the write.
                           When a write is observed by the fqcsr, the <code>busy</code>
                           bit is set to 1. When the <code>busy</code> bit is 1, behavior
                           of additional writes to the <code>fqcsr</code> are
                           <code>UNSPECIFIED</code>. Some implementations may
                           ignore the second write and others may perform the
                           actions determined by the second write.<br>
                                                                              <br>
                           Software should ensure that the <code>busy</code> bit is 0
                           before writing to the <code>fqcsr</code>.<br>
                                                                              <br>
                           An IOMMU that can complete controls synchronously
                           may hard-wire this bit to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="PQCSR"><a class="anchor" href="#PQCSR"></a>Page-request-queue CSR (<code>pqcsr</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RW) is used to control the operations and report the
status of the page-request-queue.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDUUchLzE21UlAvKEzNU6_VwSqVmYoiYwaXKUotTi0qS03BpbEwNw2nVH4auYbm43JoUmlxJaqUAX5TTeDSzqXFJfm5CqXFYK_G6igk5-elZaZbVeck5qVCVGYUFyQmp1oZGhiZ1NYCAAmZZEs=" alt="Page-request-queue CSR register fields">
</div>
<div class="title">Figure 15. Page-request-queue CSR register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqen</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page-request-enable bit enables the
                              page-request-queue when set to 1.<br>
                                                                              <br>
                              Changing <code>pqen</code> from 0 to 1, sets the <code>pqt</code>
                              register and the <code>pqcsr</code> bits <code>pqmf</code> and <code>pqof</code>
                              to 0. The page-request-queue may take some time
                              to be active following setting the <code>pqen</code> to 1.
                              During this delay the <code>busy</code> bit is 1. When the
                              page-request-queue is active, the <code>pqon</code> bit
                              reads 1.<br>
                                                                              <br>
                              When <code>pqen</code> is changed from 1 to 0, the
                              page-request-queue may stay active  (with <code>busy</code>
                              asserted) until in-flight page-request writes are
                              completed. When the page-request-queue turns off,
                              the <code>pqon</code> bit reads 0.<br>
                                                                              <br>
                              When <code>pqon</code> reads 0, the IOMMU guarantees that
                              there are no older in-flight implicit writes to
                              the queue memory and no further implicit writes
                              will be generated to the queue memory.<br>
                                                                              <br>
                              The IOMMU may respond to “Page Request” messages
                              received when page-request-queue is off or in
                              the process of being turned off, as specified in
                              <a href="#ATS_PRI">[ATS_PRI]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pie</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page-request-queue-interrupt-enable
                              bit when set to 1, enables generation of
                              interrupts from page-request-queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqmf</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>pqmf</code> bit is set to 1 if the IOMMU
                              encounters an access fault when storing a
                              "Page Request" message to the page-request-queue.<br>
                                                                              <br>
                              The "Page Request" message that caused the <code>pqmf</code>
                              or <code>pqof</code> error and all subsequent "Page Request"
                              messages are discarded until software clears the
                              <code>pqof</code> and/or <code>pqmf</code> bits by writing 1 to it.<br>
                                                                              <br>
                              The IOMMU may respond to “Page Request” messages
                              that caused the <code>pqof</code> or <code>pqmf</code> bit to be set
                              and all subsequent “Page Request” messages
                              received while these bits are 1 as specified in
                              <a href="#ATS_PRI">[ATS_PRI]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqof</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page-request-queue-overflow bit is set to 1
                              if the page-request queue overflows i.e. IOMMU
                              needs to queue a "Page Request" message but the
                              page-request queue is full
                              (i.e., <code>pqt == pqh - 1</code>).<br>
                                                                              <br>
                              The "Page Request" message that caused the <code>pqmf</code>
                              or <code>pqof</code> error and all subsequent "Page Request"
                              messages are discarded until software clears the
                              <code>pqof</code> and/or <code>pqmf</code> bits by writing 1 to it.<br>
                                                                              <br>
                              The IOMMU may respond to “Page Request” messages
                              that caused the <code>pqof</code> or <code>pqmf</code> bit to be set
                              and all subsequent “Page Request” messages
                              received while these bits are 1 as specified in
                              <a href="#ATS_PRI">[ATS_PRI]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pqon</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page-request is active when <code>pqon</code> reads 1.<br></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A write to <code>pqcsr</code> may require the IOMMU to
                              perform many operations that may not occur
                              synchronously to the write. When a write is
                              observed by the <code>pqcsr</code>, the <code>busy</code> bit is set
                              to 1.<br>
                                                                              <br>
                              When the <code>busy</code> bit is 1, behavior of additional
                              writes to the <code>pqcsr</code> are <code>UNSPECIFIED</code>.
                              Some implementations may ignore the second write
                              and others may perform the actions determined by
                              the second write. Software should ensure that the
                              <code>busy</code> bit is 0 before writing to the <code>pqcsr</code>.<br>
                                                                              <br>
                              An IOMMU that can complete controls synchronously
                              may hard-wire this bit to 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="IPSR"><a class="anchor" href="#IPSR"></a>Interrupt pending status register (<code>ipsr</code>)</h3>
<div class="paragraph">
<p>This 32-bit register (RW1C) reports the pending interrupts which require
software service. Each interrupt-pending bit in the register corresponds to
a interrupt source in the IOMMU. The interrupt-pending bit in the register once
set to 1 stays 1 till software clears that interrupt-pending bit by writing 1 to
clear it.</p>
</div>
<div class="paragraph">
<p>When <code>fctl.WSI</code> is 1, the interrupt-pending bit drives the wire selected by
the corresponding <code>icvec</code> field to signal an interrupt.</p>
</div>
<div class="paragraph">
<p>When <code>fctl.WSI</code> is 0, the IOMMU signals interrupts using messages. MSI have edge
semantics and an interrupt message is generated when an interrupt-pending bit
transitions from 0 to 1. The address and data for the message are obtained from
the <code>msi_cfg_tbl</code> entry selected by the <code>icvec</code> field corresponding to the
interrupt-pending bit.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDUUchLzE21UlBPzixQr9XBJpOGU6YgF7cUmowJXKYotTi1qCw1BUXaAuGO0uKS_FxUU82wao7VUUjOz0vLTLeqzknMSwUqNNJRyCguSExOtTI0MDKprQUATOJIfA==" alt="Interrupt pending status register fields">
</div>
<div class="title">Figure 16. Interrupt pending status register fields</div>
</div>
<table id="IPSR_FIELD" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Interrupt pending status register fields</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The command-queue-interrupt-pending bit is set to
                              1 if <code>cqcsr.cie</code> is 1 and any of the following are
                              true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cqcsr.fence_w_ip</code> is 1.</p>
</li>
<li>
<p><code>cqcsr.cmd_ill</code> is 1.</p>
</li>
<li>
<p><code>cqcsr.cmd_to</code> is 1.</p>
</li>
<li>
<p><code>cqcsr.cqmf</code> is 1.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The fault-queue-interrupt-pending bit is set to 1
                              if <code>fqcsr.fie</code> is 1 and any of the following are
                              true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fqcsr.fqof</code> is 1.</p>
</li>
<li>
<p><code>fqcsr.fqmf</code> is 1.</p>
</li>
<li>
<p>A new record is produced in the FQ.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The performance-monitoring-interrupt-pending is
                              set to 1 when <code>OF</code> bit in <code>iohpmcycles</code> or in any of the
                              <code>iohpmctr1-31</code> registers transitions from 0 to 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1C</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The page-request-queue-interrupt-pending is set to
                              1 if <code>pqcsr.pie</code> is 1 and any of the following are
                              true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pqcsr.pqof</code> is 1.</p>
</li>
<li>
<p><code>pqcsr.pqmf</code> is 1.</p>
</li>
<li>
<p>A new message is produced in the PQ.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a bit in <code>ipsr</code> is 1 then a write of 1 to the bit transitions the bit from 1&#8594;0.
If the conditions to set that bit are still present (See <a href="#IPSR_FIELD">Interrupt pending status register fields</a>) or if
they occur after the bit is cleared then that bit transitions again from 0&#8594;1.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="OVF"><a class="anchor" href="#OVF"></a>Performance-monitoring counter overflow status (<code>iocountovf</code>)</h3>
<div class="paragraph">
<p>The performance-monitoring counter overflow status is a 32-bit read-only
register that contains shadow copies of the OF bits in the <code>iohpmevt1-31</code>
registers - where <code>iocountovf</code> bit X corresponds to <code>iohpmevtX</code> and bit 0
corresponds to the <code>OF</code> bit of <code>iohpmcycles</code>.</p>
</div>
<div class="paragraph">
<p>This register enables overflow interrupt handler software to quickly and easily
determine which counter(s) have overflowed.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1FHIS8xNtVJQd45Ur9VByBgjZDwCfEFSsToKyfl5aZnpVtU5iXmpQDVAJRnFBYnJqVaGBkYmtbUAHjYb-g==" alt="Performance-monitoring counter overflow status register fields">
</div>
<div class="title">Figure 17. Performance-monitoring counter overflow status register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shadow of <code>iohpmcycles.OF</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shadow of <code>iohpmevt[1-31].OF</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="INH"><a class="anchor" href="#INH"></a>Performance-monitoring counter inhibits (<code>iocountinh</code>)</h3>
<div class="paragraph">
<p>The performance-monitoring counter inhibits is a 32-bit WARL register
that contains bits to inhibit the corresponding counters from counting. Bit X
when set inhibits counting in <code>iohpmctrX</code> and bit 0 inhibits counting in
<code>iohpmcycles</code>.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UlAw1FHIS8xNtVJQd45Ur9VByBgjZDwCfEFSsToKyfl5aZnpVtU5iXmpQDVAJRnFBYnJqVaGBkYmtbUAHjYb-g==" alt="Performance-monitoring counter inhibits register fields">
</div>
<div class="title">Figure 18. Performance-monitoring counter inhibits register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CY</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set, <code>iohpmcycles</code> counter is inhibited
                              from counting.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When bit X is set, then counting of events in
                              <code>iohpmctrX</code> is inhibited.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the <code>iohpmcycles</code> counter is not needed, it is desirable to conditionally
inhibit it to reduce energy consumption. Providing a single register to
inhibit all counters allows a) one or more counters to be atomically programmed
with events to count b) one or more counters to be sampled atomically.</p>
</div>
<div class="paragraph">
<p>To initialize an event counter or the cycles counter to a desired value, it
should be first inhibited if it is enabled to count. This measure ensures that
it does not count during the update process. The inhibition should be removed
after the register has been programmed with the desired value.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="CYC"><a class="anchor" href="#CYC"></a>Performance-monitoring cycles counter (<code>iohpmcycles</code>)</h3>
<div class="paragraph">
<p>This 64-bit register is a free running clock cycle counter.
There is no associated <code>iohpmevt0</code>.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjAz1lHIS8xNtVJQT84vzStJLVKv1UFIG8Jl_d1AErE6Csn5eWmZ6VbVOYl5qUAVRjoKGcUFicmpVoYGRia1tQC9SB30" alt="Performance-monitoring cycles counter register fields">
</div>
<div class="title">Figure 19. Performance-monitoring cycles counter register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">62:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>counter</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycles counter value.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overflow</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>OF</code> bit is set when the <code>iohpmcycles</code> counter overflows, and remains set
until cleared by software. Since <code>iohpmcycles</code> value is an unsigned value,
overflow is defined as unsigned overflow. Note that there is no loss of
information after an overflow since the counter wraps around and keeps counting
while the sticky <code>OF</code> bit remains set.</p>
</div>
<div class="paragraph">
<p>If the <code>iohpmcycles</code> counter overflows when the <code>OF</code> bit is zero, then a HPM
Counter Overflow interrupt is generated by setting <code>ipsr.pmip</code> bit to 1. If
the <code>OF</code> bit is already one, then no interrupt request is generated. Consequently
the <code>OF</code> bit also functions as a count overflow interrupt disable for the
<code>iohpmcycles</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="CTR"><a class="anchor" href="#CTR"></a>Performance-monitoring event counters (<code>iohpmctr1-31</code>)</h3>
<div class="paragraph">
<p>These registers are 64-bit WARL counter registers.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjAz0VHIS8xNtVJQT84vzStJLVKv1eGK1VFIzs9Ly0y3qs5JzEsFqjPUUcgoLkhMTrUyNDAyqa0FAEyMFx8=" alt="Performance-monitoring event counters register fields">
</div>
<div class="title">Figure 20. Performance-monitoring event counters register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>counter</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event counter value.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="EVT"><a class="anchor" href="#EVT"></a>Performance-monitoring event selectors (<code>iohpmevt1-31</code>)</h3>
<div class="paragraph">
<p>These performance-monitoring event registers are 64-bit RW registers. When a
transaction processed by the IOMMU causes an event that is programmed to count
in a counter then the counter is incremented. In addition to matching events,
the event selector may be programmed with additional filters based on
<code>device_id</code>, <code>process_id</code>, <code>GSCID</code>, and <code>PSCID</code> such that the counter is
incremented conditionally based on the transaction matching these additional
filters. When such <code>device_id</code> based filtering is used, the match may be
configured to be a precise match or a partial match. A partial match allows
transactions with a range of IDs to be counted by the counter.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA01VHIS8xNtVJQTy1LzSvxdFGv1UGShsu6-DoGe6PIGRnAJQM8XeIDgp3RNBuZIHQDFbhjKECYHhAG0h-Gy-4wkGZcsp4uIThk_N1AErE6Csn5eWmZ6VbVOYl5qUAVFjoKGcUFicmpVoYGRia1tQAQVU-T" alt="Performance-monitoring event selector register fields">
</div>
<div class="title">Figure 21. Performance-monitoring event selector register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eventID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Indicates the event to count. A value of 0
                                 indicates no events are counted.<br>
                                 Encodings 1 to 16383 are reserved for standard
                                 events defined in the <a href="#Event_list">Standard Events list</a>.<br>
                                 Encodings 16384 to 32767 are for designated for
                                 custom use.<br>
                                 When <code>eventID</code> is changed, including to 0,
                                 the counter retains its value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMASK</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set to 1, partial matching of the
                                 <code>DID_GSCID</code> is performed for the transaction.
                                 The lower bits of the <code>DID_GSCID</code> all the way
                                 to the first low order 0 bit (including
                                 the 0 bit position itself) are masked.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">35:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PID_PSCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>process_id</code> if <code>IDT</code> is 0,
                                 <code>PSCID</code> if <code>IDT</code> is 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">59:36</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DID_GSCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>device_id</code> if <code>IDT</code> is 0,
                                 <code>GSCID</code> if <code>IDT</code> is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PV_PSCV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, only transactions with matching
                                 <code>process_id</code> or <code>PSCID</code> (based on the Filter
                                 ID Type) are counted.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DV_GSCV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, only transactions with matching
                                 <code>device_id</code> or <code>GSCID</code> (based on the Filter ID
                                 Type) are counted.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">62</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IDT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filter ID Type: This field indicates the type
                                 of ID to filter on. When 0, the <code>DID_GSCID</code>
                                 field holds a <code>device_id</code> and the <code>PID_PSCID</code>
                                 field holds a <code>process_id</code>. When 1, the
                                 <code>DID_GSCID</code> field holds a <code>GSCID</code> and
                                 <code>PID_PSCID</code> field holds a <code>PSCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OF</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overflow status or Interrupt disable</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The table below summarizes the filtering option for events that support
filtering by IDs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. filtering options</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong><code>IDT</code></strong></th>
<th class="tableblock halign-left valign-top"><strong><code>DV_GSCV</code></strong></th>
<th class="tableblock halign-left valign-top"><strong><code>PV_PSCV</code></strong></th>
<th class="tableblock halign-left valign-top"><strong>Operation</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter increments. No ID based
                                        filtering.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the transaction has a valid
                                        <code>process_id</code>, counter increments if
                                        process_id matches <code>PID_PSCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter increments if <code>device_id</code>
                                        matches <code>DID_GSCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the transaction has a valid
                                        <code>process_id</code>, counter increments if
                                        <code>device_id</code> matches <code>DID_GSCID</code> and
                                        <code>process_id</code> matches <code>PID_PSCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the transaction has a valid
                                        <code>PSCID</code>, counter increments if
                                        the <code>PSCID</code> of that process matches
                                        <code>PID_PSCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter increments if <code>GSCID</code> is valid
                                        and matches <code>DID_GSCID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter increments if <code>GSCID</code> is valid
                                        and matches <code>DID_GSCID</code> and if <code>PSCID</code>
                                        is valid and matches <code>PID_PSCID</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When filtering by <code>device_id</code> or <code>GSCID</code> is selected and the event supports
ID based filtering, the DMASK field can be used to configure a partial match.
When DMASK is set to 1, partial matching of the <code>DID_GSCID</code> is performed for
the transaction. The lower bits of the <code>DID_GSCID</code> all the way to the first
low order 0 bit (including the 0 bit position itself) are masked.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the use of DMASK and filtering by <code>device_id</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. <code>DMASK</code> with <code>IDT</code> set to <code>device_id</code> based filtering</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><code>DMASK</code></th>
<th class="tableblock halign-left valign-top"><code>DID_GSCID</code></th>
<th class="tableblock halign-left valign-top"><strong>Comment</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyyyyyy  yyyyyyyy  yyyyyyyy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One specific seg:bus:dev:func</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyyyyyy  yyyyyyyy  yyyyy011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seg:bus:dev - any func</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyyyyyy  yyyyyyyy  01111111</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seg:bus - any dev:func</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyyyyyy  01111111  11111111</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">seg - any bus:dev:func</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table lists the standard events that can be counted:</p>
</div>
<table id="Event_list" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Standard Events list</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong>eventID</strong></th>
<th class="tableblock halign-left valign-top"><strong>Event counted</strong></th>
<th class="tableblock halign-center valign-top"><strong>IDT settings supported</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not count</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Untranslated requests</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Translated requests</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATS Translation requests</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLB miss</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0/1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Directory Walks</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process Directory Walks</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First-stage Page Table Walks</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0/1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Second-stage Page Table Walks</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0/1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9 - 16383</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved for future standard</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the programmed <code>IDT</code> setting is not supported for an event then the
associated counter does not increment.</p>
</div>
<div class="paragraph">
<p>The <code>OF</code> bit is set when the corresponding <code>iohpmctr1-31</code> counter overflows,
and remains set until cleared by software. Since <code>iohpmctr1-31</code> values are
unsigned values, overflow is defined as unsigned overflow. Note that there is no
loss of information after an overflow since the counter wraps around and keeps
counting while the sticky <code>OF</code> bit remains set.</p>
</div>
<div class="paragraph">
<p>If a <code>iohpmctr1-31</code> counter overflows when the associated <code>OF</code> bit is zero, then
a HPM Counter Overflow interrupt is generated by setting <code>ipsr.pmip</code> bit to 1. If
the <code>OF</code> bit is already one, then no interrupt request is generated. Consequently
the <code>OF</code> bit also functions as a count overflow interrupt disable for the
associated <code>iohpmctr1-31</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are not separate overflow status and overflow interrupt enable bits. In
practice, enabling overflow interrupt generation (by clearing the <code>OF</code> bit) is
done in conjunction with initializing the counter to a starting value. Once a
counter has overflowed, it and the <code>OF</code> bit must be reinitialized before
another overflow interrupt can be generated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In RV32, memory-mapped writes to <code>iohpmevt1-31</code> modify only one 32-bit part of
the register. The following sequence may be used to update the register without
counting events spuriously due to the intermediate value of the register:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Write the low order 32-bits to set <code>eventID</code> to 0.</p>
</li>
<li>
<p>Write the high order 32-bits with the new desired values.</p>
</li>
<li>
<p>Write the low order 32-bits the new desired values, including that of the
<code>eventID</code> field.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, the counter may first be inhibited such that no events count
during the update and the inhibit removed after the register has been programmed
with the desired value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>capabilities.HPM</code> is 1 then a minimum of one programmable event counter
besides the cycles counter is required to comply with this specification. One
counter may be used in a time multiplexed manner to sample events but such
analysis may take longer to complete. The IOMMU, unlike the CPU MMU, services
multiple streams of IO and the HPM may be used by a performance analyst to
analyze one or more of those streams concurrently. Typically, a performance
analyst may require four programmable counters to count events for an IO
stream. To support concurrent analysis of at least two streams of IO it is
recommended to support seven programmable counters.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="TRR_IOVA"><a class="anchor" href="#TRR_IOVA"></a>Translation-request IOVA (<code>tr_req_iova</code>)</h3>
<div class="paragraph">
<p>The <code>tr_req_iova</code> is a 64-bit register used to implement a
translation-request interface for debug. This register is present when
<code>capabilities.DBG == 1</code>.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA00lHIS8xNtVJQL0otTi0qS01Rr9VByJsi5MsK8kBSsToKyfl5aZnpVtU5iXmpQDVAJRnFBYnJqVaGBkYmtbUAKHEfQw==" alt="Translation-request IOVA register fields">
</div>
<div class="title">Figure 22. Translation-request IOVA register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vpn</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IOVA virtual page number</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="TRR_CTRL"><a class="anchor" href="#TRR_CTRL"></a>Translation-request control (<code>tr_req_ctl</code>)</h3>
<div class="paragraph">
<p>The <code>tr_req_ctl</code> is a 64-bit WARL register used to implement a
translation-request interface for debug. This register is present when
<code>capabilities.DBG == 1</code>.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDUUchLzE21UlB3z9d3Ki2uVK_VwSYbUJRZhkPKtSIVh4xfOIqEBVyiKLU4tagsNQVF2sgAYZunCy53hKFIGOM30gQunVxaXJKfi2ofQtYFYl-sjkJyfl5aZrpVdU5iXirEgIzigsTkVCtDAyOT2loAjD9eOg==" alt="Translation-request control register fields">
</div>
<div class="title">Figure 23. Translation-request control register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Go/Busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW1S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This bit is set to indicate a valid
                                 request has been setup in the
                                 <code>tr_req_iova/tr_req_ctl</code> registers
                                 for the IOMMU to translate.<br>
                                                                              <br>
                                 The IOMMU indicates completion of the
                                 requested translation by clearing this
                                 bit to 0. On completion, the results
                                 of the translation are in the <code>tr_response</code>
                                 register.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to 1, Privileged Mode access
                                 is requested else no Privileged Mode access
                                 is not requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Exe</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to 1, execute permission is
                                 requested else execute permission is not
                                 requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NW</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to 1, read permission is requested.
                                 If set to 0, both read and write permissions
                                 are requested.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>PV</code> is 1, this field provides the
                                 <code>process_id</code> input for this translation request.
                                 If <code>PV</code> is 0 then this field is not used.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PV</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to 1, the <code>PID</code> field of the
                                 register is valid and provides the <code>process_id</code>
                                 for this translation request. If set to 0 then
                                 the <code>PID</code> field is not used and a <code>process_id</code>
                                 is not valid for this translation request.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">35:33</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">39:36</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>custom</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Designated for custom use.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field provides the <code>device_id</code> for
                                 this translation request.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In RV32, the high half of the register should be written first, followed by the
low half, which includes the <code>Go/Busy</code> bit, to initiate a translation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="TRR_RSP"><a class="anchor" href="#TRR_RSP"></a>Translation-response (<code>tr_response</code>)</h3>
<div class="paragraph">
<p>The <code>tr_response</code> is a 64-bit RO register used to hold the results
of a translation requested using the translation-request interface.
This register is present when <code>capabilities.DBG == 1</code>.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDUUchLzE21UlBPSyzNKVGv1UHImcHlilKLU4vKUlNQpI3g0gFOviEoUghTg1HETUwQegL8SLEMoTG5tLgkPxckGaujkJyfl5aZblWdk5iXClGVUVyQmJxqZWhgZFJbCwAkvEeZ" alt="Translation-response register fields">
</div>
<div class="title">Figure 24. Translation-response register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fault</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the process to translate the IOVA detects
                                 a fault then the <code>fault</code> field is set to 1.
                                 The detected fault may be reported through the
                                 fault-queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8:7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBMT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory type determined for the translation
                                 using the PBMT fields in the first-stage and/or
                                 the second-stage page tables used for the
                                 translation. This value of this field is
                                 <code>UNSPECIFIED</code> if the <code>fault</code> field is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>S</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Translation range size field, when set to 1
                                 indicates that the translation applies to a
                                 range that is larger than 4 KiB and the size
                                 of the translation range is encoded in the
                                 <code>PPN</code> field. The value of this field is
                                 <code>UNSPECIFIED</code> if the <code>fault</code> field is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">53:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PPN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If the <code>fault</code> bit is 0, then this field
                                 provides the PPN determined as a result of
                                 translating the <code>vpn</code> in <code>tr_req_iova</code>.<br>
<br>
                                 If the <code>fault</code> bit is 1, then the value of
                                 this field is <code>UNSPECIFIED</code>.<br>
<br>
                                 If the <code>S</code> bit is 0, then the size of the
                                 translation is 4 KiB - a page.<br>
<br>
                                 If the <code>S</code> bit is 1, then the translation
                                 resulted in a superpage, and the size of the
                                 superpage is encoded in the PPN itself. If
                                 scanning from bit position 0 to bit position
                                 43, the first bit with a value of 0 at
                                 position <code>X</code>, then the superpage size is
                                <code>2<sup>X+1</sup> * 4</code> KiB.<br>
<br>
                                 If <code>X</code> is not 0, then all bits at position 0
                                 through <code>X-1</code> are each encoded with a value
                                 of 1.
<br></p>
</div>
<table class="tableblock frame-all grid-all fit-content center">
<caption class="title">Table 6. Example of encoding of super page size in <code>PPN</code></caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><code>PPN</code></th>
<th class="tableblock halign-center valign-top"><code>S</code></th>
<th class="tableblock halign-center valign-top">Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyy&#8230;&#8203;.yyyy yyyy yyyy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 KiB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyy&#8230;&#8203;.yyyy yyyy 0111</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64 KiB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyy&#8230;&#8203;.yyy0 1111 1111</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 MiB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yyyy&#8230;&#8203;.yy01 1111 1111</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 MiB</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">59:54</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:60</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>custom</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Designated for custom use.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An IOMMU implementation is not required to report a superpage translation
or support reporting all possible superpage sizes. An implementation is
allowed to report a 4 KiB translation corresponding to the requested
<code>vpn</code> or report a translation size that is smaller than the superpage
size configured in the page tables.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="IOQOSID"><a class="anchor" href="#IOQOSID"></a>IOMMU QoS ID (<code>iommu_qosid</code>)</h3>
<div class="paragraph">
<p>The <code>iommu_qosid</code> register fields are defined as follows:</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA00lHIS8xNtVJQD3L2dFGv1UHIKZjA5cIDgjxR5JD0-RKhL1ZHITk_Ly0z3ao6JzEvFWSAjkJGcUFicqqVoYGRSW0tABHXLBM=" alt="`iommu_qosid` register fields">
</div>
<div class="title">Figure 25. <code>iommu_qosid</code> register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 22.2222%;">
<col style="width: 11.1111%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RCID</code> for IOMMU-initiated requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MCID</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MCID</code> for IOMMU-initiated requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>IOMMU-initiated requests for accessing the following data structures use the
value programmed in the <code>RCID</code> and <code>MCID</code> fields of the <code>iommu_qosid</code> register.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Device directory table (<code>DDT</code>)</p>
</li>
<li>
<p>Fault queue (<code>FQ</code>)</p>
</li>
<li>
<p>Command queue (<code>CQ</code>)</p>
</li>
<li>
<p>Page-request queue (<code>PQ</code>)</p>
</li>
<li>
<p>IOMMU-initiated MSI (Message-signaled interrupts)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <code>ddtp.iommu_mode == Bare</code>, all device-originated requests are
associated with the QoS IDs configured in the <code>iommu_qosid</code> register.</p>
</div>
</div>
<div class="sect2">
<h3 id="ICVEC"><a class="anchor" href="#ICVEC"></a>Interrupt-cause-to-vector register (<code>icvec</code>)</h3>
<div class="paragraph">
<p>Interrupt-cause-to-vector register maps a cause to a vector.  All causes can
be mapped to the same vector or a cause can be given a unique vector.</p>
</div>
<div class="paragraph">
<p>The vector is used:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By an IOMMU that generates interrupts as MSIs, to index into MSI
configuration table (<code>msi_cfg_tbl</code>) to determine the MSI to generate. An
IOMMU is capable of generating interrupts as a MSI if <code>capabilities.IGS==MSI</code>
or if <code>capabilities.IGS==BOTH</code>. When <code>capabilities.IGS==BOTH</code> the IOMMU may be
configured to generate interrupts as MSI by setting <code>fctl.WSI</code> to 0.</p>
</li>
<li>
<p>By an IOMMU that generates WSI, to determine the wire
to signal the interrupt. An IOMMU is capable of generating wire-signaled-
interrupts if <code>capabilities.IGS==WSI</code> or if <code>capabilities.IGS==BOTH</code>. When
<code>capabilities.IGS==BOTH</code> the IOMMU may be configured to generate wire-signaled-
interrupts by setting <code>fctl.WSI</code> to 1.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If an implementation only supports a single vector then all bits of this
register may be hardwired to 0 (WARL). Likewise if only two vectors are
supported then only bit 0 for each cause could be writable.</p>
</div>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDRUchLzE21UlBPzixTr9XBJpOGU6YgF7cUmoyhGVyqKLU4tagsNQVF3tgI4ZLS4pL8XJBsrI5Ccn5eWma6VXVOYl4qxIKM4oLE5FQrQwMjk9paAG_-Pyw=" alt="Interrupt-cause-to-vector register fields">
</div>
<div class="title">Figure 26. Interrupt-cause-to-vector register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>civ</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The command-queue-interrupt-vector (<code>civ</code>)
                               is the vector number assigned to the
                               command-queue-interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fiv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fault-queue-interrupt-vector (<code>fiv</code>) is the
                               vector number assigned to the
                               fault-queue-interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmiv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The performance-monitoring-interrupt-vector
                               (<code>pmiv</code>) is the vector number assigned to the
                               performance-monitoring-interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>piv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page-request-queue-interrupt-vector (<code>piv</code>)
                               is the vector number assigned to the
                               page-request-queue-interrupt.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designated for custom use.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="MSI"><a class="anchor" href="#MSI"></a>MSI configuration table (<code>msi_cfg_tbl</code>)</h3>
<div class="paragraph">
<p>An IOMMU that supports generating IOMMU-originated interrupts
(i.e., <code>capabilities.IGS == MSI</code> or <code>capabilities.IGS == BOTH</code>) as MSIs
implements a MSI configuration table that is indexed by the vector from <code>icvec</code>
to determine a MSI table entry. Each MSI table entry for interrupt vector <code>x</code>
has three registers <code>msi_addr_x</code>, <code>msi_data_x</code>, and <code>msi_vec_ctl_x</code>. These
registers are hardwired to 0 if <code>capabilities.IGS == WSI</code>.</p>
</div>
<div class="paragraph">
<p>If an access fault is detected on a MSI write using <code>msi_addr_x</code>, then the IOMMU
reports a "IOMMU MSI write access fault" (cause 273) fault, with <code>TTYP</code> set to 0
and <code>iotval</code> set to the value of <code>msi_addr_x</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. MSI configuration table structure</caption>
<colgroup>
<col style="width: 43.4782%;">
<col style="width: 43.4782%;">
<col style="width: 13.0436%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">bit 63</th>
<th class="tableblock halign-right valign-top">bit 0</th>
<th class="tableblock halign-left valign-top">Byte Offset</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Entry 0: Message address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+000h</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Entry 0: Vector Control</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Entry 0: Message Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+008h</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Entry 1: Message address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+010h</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Entry 1: Vector Control</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Entry 1: Message Data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+018h</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+020h</p></td>
</tr>
</tbody>
</table>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDSUchLzE21UlA3UK_VQYibmsAlHF1cglDkLOBSRanFqUVlqSkg6VgdheT8vLTMdKvqnMS8VIjZGcUFicmpVoYGRia1tQDkFiVS" alt="Message address register fields">
</div>
<div class="title">Figure 27. Message address register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed to 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">55:2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the 4-byte aligned MSI address.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">63:56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
</tbody>
</table>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjA20lHIS8xNtVJQT0ksSVSv1eGK1VFIzs9Ly0y3qs5JzEsFKjLUUcgoLkhMTrUyNDAyqa0FAPYeFbQ=" alt="Message data register fields">
</div>
<div class="title">Figure 28. Message data register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WARL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Holds the MSI data</p></td>
</tr>
</tbody>
</table>
<div class="imageblock kroki">
<div class="content">
<img src="https://kroki.io/wavedrom/svg/eNqrLkpNt1KI5lJQqE7KLCm2UjDUUchLzE21UlD3Va_VQYgbIySKUotTi8pSU0DysToKyfl5aZnpVtU5iXmpEAMyigsSk1OtDA2MTGprAaekHgY=" alt="Vector control register fields">
</div>
<div class="title">Figure 29. Vector control register fields</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">Field</th>
<th class="tableblock halign-center valign-top">Attribute</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>M</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the mask bit <code>M</code> is 1, the corresponding
                            interrupt vector is masked and the IOMMU is
                            prohibited from sending the associated message.
                            Pending messages for that vector are later
                            generated if the corresponding mask bit is
                            cleared to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">WPRI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved for standard use.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="iommu_debug.html">Debug support</a></span>
  <span class="next"><a href="iommu_sw_guidelines.html">Software guidelines</a></span>
</nav>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../../ffh/v1.0/index.html">ACPI Functional Fixed Hardware</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../ffh/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../aia/v1.0/index.html">Advanced Interrupt Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../aia/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../etrace/v1.0/index.html">E-Trace Encapsulation Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../etrace/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../psabi/v1.0/index.html">ELF psABI Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../psabi/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="index.html">IOMMU Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../isa/index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../isa/index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../reri/v1.0/index.html">RERI Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../reri/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../qos/v1.0/index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../qos/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../plic/v1.0.0/index.html">RISC-V Platform-Level Interrupt Controller</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../plic/v1.0.0/index.html">
      v1.0.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../semihost/v1.0/index.html">semihosting</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../semihost/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
