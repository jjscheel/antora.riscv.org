<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RISC-V Ratified Specifications Library</title>
    <link rel="prev" href="AdvPLIC.html">
    <link rel="next" href="VSLevel.html">
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="3f4ce2c51445edcfc62ee1f59ab97fffc218fb79"> 
    <meta name="version" content="v1.0">
    <meta name="component" content="aia">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">RISC-V Ratified Specifications Library</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="aia" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Advanced Interrupt Architecture</span>
  <span class="version">v1.0</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">RISC-V Advanced Interrupt Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="CSRs.html">Control and Status Registers (CSRs) Added to Harts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IMSIC.html">Incoming MSI Controller (IMSIC)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="AdvPLIC.html">Advanced Platform-Level Interrupt Controller (APLIC)</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link"  href="MSLevel.html">Interrupts for Machine and Supervisor Levels</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="VSLevel.html">Interrupts for Virtual Machines (VS Level)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IPIs.html">Interprocessor Interrupts (IPIs)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IOMMU.html">IOMMU Support for MSIs to Virtual Machines</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/riscv/riscv-aia/edit/antora-refactor/modules/ROOT/pages/MSLevel.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/riscv/riscv-aia" title="GitHub">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>

      <a href="" title="PDF">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          Download PDF
        </a>
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li><a href="index.html">Advanced Interrupt Architecture</a></li>
      <li>RISC-V Advanced Interrupt Architecture</li>
      <li><a href="MSLevel.html">Interrupts for Machine and Supervisor Levels</a></li>
    </ul>
  </nav>
</div><div class="sect1">
<h2 id="MSLevel"><a class="anchor" href="#MSLevel"></a>Interrupts for Machine and Supervisor Levels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The RISC-V Privileged Architecture defines several major identities in the
range 0-15 for interrupts at a hart, including machine-level and
supervisor-level external interrupts (numbers 11 and 9), machine- and
supervisor-level timer interrupts (7 and 5), and machine- and
supervisor-level software interrupts (3 and 1). Beyond these major
labels, the <em>external</em> interrupts at each privilege level are given
secondary, minor identities by an external interrupt controller such as
an APLIC or IMSIC, distinguishing interrupts from different devices or
causes. These minor identities for external interrupts were covered in
<a href="#IMSIC">[IMSIC]</a> and <a href="#AdvPLIC">[AdvPLIC]</a> specifying the IMSIC and APLIC components.</p>
</div>
<div class="paragraph">
<p>The Advanced Interrupt Architecture reserves another 24 major interrupt
identities for additional <em>local interrupts</em> that arise within or in
close proximity to the hart, often for reporting errors. A mechanism is
also defined that allows software to selectively delegate both local and
custom interrupts to the next less-privileged level, or in some cases to
inject entirely virtual interrupts into a less-privileged level.</p>
</div>
<div class="paragraph">
<p>Lastly, an optional facility lets software assign priorities to major
interrupts (such as the timer and software interrupts, and any local
interrupts) such that they may mix with the priorities set for external
interrupts by a PLIC, APLIC, or IMSIC.</p>
</div>
<div class="sect2">
<h3 id="majorIntrs"><a class="anchor" href="#majorIntrs"></a>Defined major interrupts and default priorities</h3>
<div class="paragraph">
<p><a href="#TablemajorIntrs">The standard major interrupt codes, listed in default priority order</a> lists all the major interrupts
currently defined for RISC-V harts that conform to this Advanced Interrupt
Architecture (AIA). Besides the major interrupts specified by the
RISC-V Privileged Architecture, the AIA adds interrupt numbers 35 and 43 as
local interrupts for low- and high-priority <em>RAS events</em>.</p>
</div>
<table id="TablemajorIntrs" class="tableblock frame-all grid-all fit-content center">
<caption class="title">Table 1. The standard major interrupt codes, listed in default priority order</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default priority order</th>
<th class="tableblock halign-left valign-top">Major interrupt numbers</th>
<th class="tableblock halign-center valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Highest<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Lowest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local interrupt: high-priority RAS event</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11, 3, 7<br>
9, 1, 5<br>
12<br>
10, 2, 6<br>
13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupts: external, software, timer<br>
Supervisor interrupts: external, software, timer<br>
Supervisor guest external interrupt<br>
VS interrupts: external, software, timer<br>
Local interrupt: counter overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">35</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local interrupt: low-priority RAS event</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The default priority order in <a href="#TablemajorIntrs">The standard major interrupt codes, listed in default priority order</a> is applicable only
when multiple major interrupts would trap to the same privilege mode.
Interrupt traps to a more-privileged mode always have
priority over traps to a less-privileged mode.</p>
</div>
<table id="TablemajorIntrCategories" class="tableblock frame-all grid-all fit-content center">
<caption class="title">Table 2. Categorization of current and future major interrupts.</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Major interrupt numbers</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Category</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0-12<br>
13-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Local interrupts<br>
Local interrupts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned by the<br>
Privileged Architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-23<br>
24-31<br>
32-47<br>
&#8805; 48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local interrupts<br>
<em>Designated for custom use</em><br>
Local interrupts<br>
<em>Designated for custom use</em></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Of the major interrupts controlled by the base Privileged Architecture
(numbers 0-15), the AIA categorizes the counter overflow interrupt
(code 13) as a <em>local interrupt</em>. It is assumed furthermore that any
future definitions for reserved interrupt numbers 14 and 15 will also be
local interrupts. Besides the two RAS interrupts, the AIA additionally
reserves major interrupt numbers in the ranges 16-23 and 32-47 for
standard local interrupts that other RISC-V extensions may define. The
remaining major interrupts allocated to the Privileged Architecture,
numbers 0-12, are categorized as not local interrupts. Taken altogether,
<a href="#TablemajorIntrCategories">Categorization of current and future major interrupts.</a> summarizes the AIA&#8217;s categorization of all major interrupt identities.</p>
</div>
<div class="paragraph">
<p><em>RAS</em> is an abbreviation for <em>Reliability, Availability, and
Serviceability</em>. Typically a RAS event corresponds to the detection of
corrupted data (e.g. as a result of a soft or hard error) and/or the use
of such data. The high-priority RAS event local interrupt may, for
example, signal an occurrence of an urgent uncorrected error that needs
action from a RAS error handler to contain the error and, if possible,
to recover from it. The low-priority RAS event local interrupt may, for
example, be triggered by non-urgent deferred or corrected errors.</p>
</div>
<div class="paragraph">
<p>The AIA does not itself require that detected RAS events trigger one of
the two local interrupts defined for this purpose. Systems are free to
report any or all RAS events another way, such as by external interrupts
routed through an APLIC or IMSIC, or by custom interrupts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In all likelihood, the method for reporting a particular RAS event will
depend on where in the system the event is detected. The AIA defines
local interrupt numbers for RAS events so systems have a standard way to
report such events when detected locally at a hart, without depending
solely on external or custom interrupts.</p>
</div>
<div class="paragraph">
<p>As always, platform standards may further constrain how a system reports
events, whether RAS events or other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the standard local interrupts not defined by the base RISC-V Privileged
Architecture (numbers 16-23 and 32-47), the current plan is to assign
default priorities in the order shown in this table:</p>
</div>
<table class="tableblock frame-all grid-all fit-content center">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Highest<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Lowest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47, 23, 46, 45, 22, 44,<br>
43, 21, 42, 41, 20, 40</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11, 3, 7<br>
9, 1, 5<br>
12<br>
10, 2, 6<br>
13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupts: external, software, timer<br>
Supervisor interrupts: external, software, timer<br>
Supervisor guest external interrupt<br>
VS interrupts: external, software, timer<br>
Counter overflow interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">39, 19, 38, 37, 18, 36,<br>
35, 17, 34, 33, 16, 32</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Among interrupts 16-23, a higher interrupt number conveys higher default
priority, and likewise for interrupts 32-47. These two groups are
interleaved together in the complete order, and the Privileged
Architecture&#8217;s standard interrupts, 0-15, are inserted into the middle
of the sequence. This proposed default priority order is arranged so
that interrupts 0-31 can potentially be an adequate subset on their own
for 32-bit RISC-V systems.</p>
</div>
<div class="paragraph">
<p>In actuality, future RISC-V extensions may or may not stick to this plan for
the default priority order of interrupts they define.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In addition to the existing major interrupts of
<a href="#TablemajorIntrs">The standard major interrupt codes, listed in default priority order</a>, the following local interrupts
are tentatively proposed, listed in order of decreasing default
priority:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus or system error</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per-core high-power or over-temperature event</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug/trace interrupt</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These local interrupts are expected to be specified by other RISC-V extensions.
Be aware, this list is not final and may change as the relevant
extensions are developed and ratified.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a future version of the RISC-V Privileged Architecture defines interrupt 0,
the Advanced Interrupt Architecture needs it to have a default priority
lower than certain external interrupts. See <a href="#mtopi">Machine top interrupt CSR (<code>mtopi</code>)</a>
and <a href="#stopi">Supervisor top interrupt CSR (<code>stopi</code>)</a> on CSRs <code>mtopi</code> and <code>stopi</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Interrupt numbers 24-31 and 48 and higher are all designated for custom
use. If a hart implements any custom interrupts, their positions in the
default priority order must be documented for the hart.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While many of the standard registers such as <code>mip</code> and <code>mie</code> have space for major
interrupts only in the range 0-63, custom interrupts with numbers 64 and
above are conceivable with added custom support. CSRs <code>mtopi</code>
(<a href="#mtopi">Machine top interrupt CSR (<code>mtopi</code>)</a>) and <code>stopi</code> (<a href="#stopi">Supervisor top interrupt CSR (<code>stopi</code>)</a>) allow for
major interrupt numbers potentially as large as 4095.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a hart supports the arbitrary configuration of interrupt priorities
by software (described in later sections), the default priority order
still remains relevant for breaking ties when two interrupt sources are
assigned the same priority number.</p>
</div>
</div>
<div class="sect2">
<h3 id="interrupts-at-machine-level"><a class="anchor" href="#interrupts-at-machine-level"></a>Interrupts at machine level</h3>
<div class="paragraph">
<p>For whichever standard local interrupts are implemented, the
corresponding bits in CSRs <code>mip</code> and <code>mie</code>  must be writable, and the corresponding
bits in <code>mideleg</code> (if that CSR exists because supervisor mode is implemented) must
each either be writable or be hardwired to zero. An occurrence of a
local interrupt event causes the interrupt-pending bit in <code>mip</code> to be set to
one. This bit then remains set until cleared by software.</p>
</div>
<div class="paragraph">
<p>As established by the base RISC-V Privileged Architecture, an interrupt traps to
M-mode whenever all of the following are true: (a) either the current
privilege mode is M-mode and machine-level interrupts are enabled by the
MIE bit of <code>mstatus</code>, or the current privilege mode has less privilege than
M-mode; (b) matching bits in <code>mip</code> and <code>mie</code> are both one; and (c) if <code>mideleg</code> exists, the corresponding bit in <code>mideleg</code> is zero.</p>
</div>
<div class="paragraph">
<p>When multiple interrupt causes are ready to trigger simultaneously, the
interrupt taken first is determined by priority order, which may be the
default order specified in the previous section <a href="#majorIntrs">Defined major interrupts and default priorities</a>, or may be a modified order configured by software.</p>
</div>
<div class="sect3">
<h4 id="intrPrios-M"><a class="anchor" href="#intrPrios-M"></a>Configuring priorities of major interrupts at machine level</h4>
<div class="paragraph">
<p>The machine-level priorities for major interrupts 0-63 may be configured
by a set of registers accessed through the <code>miselect</code> and <code>mireg</code> CSRs introduced in
<a href="#CSRs">[CSRs]</a>. When XLEN = 32, sixteen of these registers are defined, listed below with their <code>miselect</code> addresses:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio15</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each register controls the priorities of four interrupts, with one 8-bit
byte per interrupt. For a number \(k\) in the range 0-15,
register <code>iprio</code>\(k\) controls the priorities of interrupts
\(k\times{4}\) through
\({k\times{4}+{3}}\), formatted as follows:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 7:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 15:8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{1}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 23:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{2}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 31:24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{3}\)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When XLEN = 64, only the even-numbered registers exist:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3E</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio14</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each register controls the priorities of eight interrupts. For
even \(k\) in the range 0-14, register <code>iprio</code>\(k\)
controls the priorities of interrupts \(k\times{4}\)
through \({k\times{4}+{7}}\), formatted as follows:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 7:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 15:8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{1}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 23:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{2}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 31:24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{3}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 39:32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{4}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 47:40</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{5}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 55:48</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{6}\)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 63:56</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Priority number for interrupt \(k\times{4}+{7}\)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When XLEN = 64 and <code>miselect</code> is an odd value in the range <code>0x31</code>-<code>0x3F</code>, attempting to access <code>mireg</code> raises an illegal instruction exception.</p>
</div>
<div class="paragraph">
<p>The valid registers <code>iprio0</code>-<code>iprio15</code> are known collectively as the <code><em>iprio</em></code> <em>array</em> for machine level.</p>
</div>
<div class="paragraph">
<p>The width of priority numbers for external interrupts is <em>IPRIOLEN</em>.
This parameter is affected by the main external interrupt controller for
the hart, whether a PLIC, APLIC, or IMSIC.</p>
</div>
<div class="paragraph">
<p>For an APLIC, IPRIOLEN is in the range 1-8 as specified in <a href="#AdvPLIC">[AdvPLIC]</a> on the APLIC.</p>
</div>
<div class="paragraph">
<p>For an IMSIC, IPRIOLEN is 6, 7, or 8. IPRIOLEN may be 6 only if the
number of external interrupt identities implemented by the IMSIC is 63.
IPRIOLEN may be 7 only if the number of external interrupt identities
implemented by the IMSIC is no more than 127. IPRIOLEN may be 8 for any
IMSIC, regardless of the number of external interrupt identities
implemented.</p>
</div>
<div class="paragraph">
<p>Each byte of a valid <code>iprio</code>\(k\) register is either a read-only zero
or a <strong>WARL</strong> unsigned integer field implementing exactly IPRIOLEN bits. For a
given interrupt number, if the corresponding bit in <code>mie</code> is read-only zero,
then the interrupt&#8217;s priority number in the <code>iprio</code> array must be read-only zero
as well. The priority number for a machine-level external interrupt
(bits 31:24 of register <code>iprio2</code>) must also be read-only zero. Aside from these
two restrictions, implementations may freely choose which priority
number fields are settable and which are read-only zeros. If all bytes
in the <code>iprio</code> array are read-only zeros, priorities can be configured only for
external interrupts, not for any other interrupts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Platform standards may require that priorities be configurable for
certain interrupt causes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>iprio</code> array accessed via <code>miselect</code> and <code>mireg</code> affects the prioritization of interrupts only when they trap to M-mode. When an interrupt’s priority number in the
array is zero (either read-only zero or set to zero), its priority is
the default order from <a href="#majorIntrs">Defined major interrupts and default priorities</a>. Setting an
interrupt&#8217;s priority number instead to a nonzero value \(p\)
gives that interrupt nominally the same priority as a machine-level
external interrupt with priority number \(p\). For a major
interrupt that defaults to a higher priority than machine external
interrupts, setting its priority number to a nonzero value <em>lowers</em> its
priority. For a major interrupt that defaults to a lower priority than
machine external interrupts, setting its priority number to a nonzero
value <em>raises</em> its priority. When two interrupt causes have been
assigned the same nominal priority, ties are broken by the default
priority order. <a href="#TableintrPrios-M">Effect of the machine-level iprio array on the priorities of interrupts taken in M-mode. For interrupts with the same priority number, the default order of Defined major interrupts and default priorities prevails.</a> summarizes the effect of priority numbers on interrupt priority.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a hart has an IMSIC supporting more than 255 minor identities for
external interrupts, the only non-default priorities that can be
configured for other interrupts are those corresponding to external
interrupt identities 1-255, not those of identities 256 or higher.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="TableintrPrios-M" class="tableblock frame-all grid-all stretch center">
<caption class="title">Table 3. Effect of the machine-level iprio array on the priorities of interrupts taken in M-mode. For interrupts with the same priority number, the default order of <a href="#majorIntrs">Defined major interrupts and default priorities</a> prevails.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top">Interrupts with default priority above machine external interrupts</th>
<th class="tableblock halign-center valign-top">Machine external interrupts</th>
<th class="tableblock halign-center valign-top">Interrupts with default priority below machine external interrupts</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority<br>
order</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority number in machine-level <code>iprio</code> array</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority number from interrupt controller (APLIC or IMSIC)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority number in machine-level <code>iprio</code> array</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Highest</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<br>
2<br>
&#8230;&#8203;<br>
254<br>
255</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<br>
2<br>
&#8230;&#8203;<br>
254<br>
255</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<br>
2<br>
&#8230;&#8203;<br>
254<br>
255</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">256 and above (IMSIC only)</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Lowest</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Implementing the priority configurability of this section requires that
a RISC-V hart&#8217;s external interrupt controller communicate to the hart not only
the existence of a pending-and-enabled external interrupt but also the
interrupt&#8217;s priority number. Typically this implies that the width of
the connection for signaling an external interrupt to the hart is not
just a single wire as usual but now \({IPRIOLEN} + 1$\)
wires.</p>
</div>
<div class="paragraph">
<p>It is expected that many systems will forego priority configurability of
major interrupts and simply have the array be all read-only zeros.
Systems that need this priority configurability can try to arrange for
each hart&#8217;s external interrupt controller to be relatively close to the
hart, by, for example, limiting the system to at most a few small cores
connected to an APLIC, or alternatively by giving every hart its own
IMSIC.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If supported, setting the priority number for supervisor-level external
interrupts (bits 15:8 of <code>iprio2</code>) to a nonzero value \(p\) has the
effect of giving the entire category of supervisor external interrupts
nominally the same priority as a machine external interrupt with
priority number \(p\). But note that this applies only to the
case when supervisor external interrupts trap to M-mode.</p>
</div>
<div class="paragraph">
<p>(Because supervisor guest external interrupts and VS-level external
interrupts are required to be delegated to supervisor level when the
H extension is implemented, the machine-level priority numbers
for these interrupts are always ignored and should be read-only zeros.)</p>
</div>
<div class="paragraph">
<p>If the system has an original PLIC for backward compatibility with older
software, reset should initialize the machine-level <code>iprio</code> array to all zeros.</p>
</div>
</div>
<div class="sect3">
<h4 id="mtopi"><a class="anchor" href="#mtopi"></a>Machine top interrupt CSR (<code>mtopi</code>)</h4>
<div class="paragraph">
<p>Machine-level CSR <code>mtopi</code> is read-only with width MXLEN. A read of <code>mtopi</code> returns
information about the highest-priority pending-and-enabled interrupt for
machine level, in this format:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 27:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IID</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 7:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IPRIO</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All other bits of <code>mtopi</code> are reserved and read as zeros.</p>
</div>
<div class="paragraph">
<p>The value of <code>mtopi</code> is zero unless there is an interrupt pending in <code>mip</code> and enabled
in <code>mie</code> that is not delegated to a less-privileged level. When there is a
pending-and-enabled major interrupt for machine level, field IID
(Interrupt Identity) is the major identity number of the
highest-priority interrupt, and field IPRIO indicates its priority.</p>
</div>
<div class="paragraph">
<p>If all bytes of the machine-level <code>iprio</code> array are read-only zeros, a
simplified implementation of field IPRIO is allowed in which its value
is always 1 whenever <code>mtopi</code> is not zero.</p>
</div>
<div class="paragraph">
<p>Otherwise, when <code>mtopi</code> is not zero, if the priority number for the reported
interrupt is in the range 1 to 255, IPRIO is simply that number. If the
interrupt&#8217;s priority number is zero or greater than 255, IPRIO is set to
either 0 or 255 as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the interrupt&#8217;s priority number is greater than 255, then IPRIO is
255 (lowest representable priority).</p>
</li>
<li>
<p>If the interrupt&#8217;s priority number is zero and interrupt number IID
has a default priority higher than a machine external interrupt, then
IPRIO is 0 (highest priority).</p>
</li>
<li>
<p>If the interrupt&#8217;s priority number is zero and interrupt number IID
has a default priority lower than a machine external interrupt, then
IPRIO is 255 (lowest representable priority).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To ensure that <code>mtopi</code> is never zero when an interrupt is pending and enabled
for machine level, if major interrupt 0 can trap to M-mode, it must have
a default priority lower than a machine external interrupt.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value of <code>mtopi</code> is not affected by the global interrupt enable MIE in CSR <code>mstatus</code>.</p>
</div>
<div class="paragraph">
<p>The RISC-V Privileged Architecture ensures that, when the value of <code>mtopi</code> is not zero,
a trap is taken to M-mode for the interrupt indicated by field IID if
either the current privilege mode is M and <code>mstatus</code>.MIE is one, or the current
privilege mode has less privilege than M-mode. The trap itself does not
cause the value of <code>mtopi</code> to change.</p>
</div>
<div class="paragraph">
<p>The following pseudocode shows how a machine-level trap handler might
read <code>mtopi</code> to avoid redundant restoring and saving of processor registers when
an interrupt arrives during the handling of another trap (either a
synchronous exception or an earlier interrupt):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">save processor registers
i = read CSR mcause
if (i &gt;= 0) {
    handle synchronous exception i
    restore mstatus if necessary
}
if (mstatus.MPIE == 1) {
    loop {
        i = read CSR mtopi
        if (i == 0) exit loop
        i = i&gt;&gt;16
        call the interrupt handler for major interrupt i
    }
}
restore processor registers
return from trap</code></pre>
</div>
</div>
<div class="paragraph">
<p>(This example can be further optimized, but with an increase in complexity.)</p>
</div>
<div class="paragraph">
<p>In order for this algorithm to function correctly, <code>mstatus</code>.MPIE must
be set to 1 before executing an MRET that changes the privilege mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Assuming <code>mstatus</code> is saved and restored by trap handlers at entry
and exit as is common, it is sufficient to set <code>mstatus</code>.MPIE = 1
only once, before the first use of MRET that changes privilege mode.
After an MRET, a trap back to M-mode will restore <code>mstatus</code>.MPIE = 1;
and if the trap handler preserves <code>mstatus</code>, it will
still be true before the next MRET that ends the handler.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virtIntrs-S"><a class="anchor" href="#virtIntrs-S"></a>Interrupt filtering and virtual interrupts for supervisor level</h3>
<div class="paragraph">
<p>When supervisor mode is implemented, the Advanced Interrupt Architecture
adds a facility for software filtering of interrupts and for virtual
interrupts, making use of new CSRs <code>mvien</code> (Machine Virtual Interrupt Enables)
and <code>mvip</code> (Machine Virtual Interrupt-Pending bits). <em>Interrupt filtering</em>
permits a supervisor-level interrupt (SEI or SSI) or local or custom
interrupt to trap to M-mode and then be selectively delegated by
software to supervisor level, even while the corresponding bit in <code>mideleg</code>
remains zero. The same hardware may also, under the right circumstances,
allow machine level to assert <em>virtual interrupts</em> to supervisor level
that have no connection to any real interrupt events.</p>
</div>
<div class="paragraph">
<p>Just as with CSRs <code>mip</code>, <code>mie</code>, and <code>mideleg</code>, each bit of registers <code>mvien</code> and <code>mvip</code> corresponds with an interrupt number in the range 0-63. When a bit in <code>mideleg</code> is zero and the matching bit in <code>mvien</code> is one, then the same bit position in <code>sip</code> is an alias
for the corresponding bit in <code>mvip</code>. A bit in <code>sip</code> is read-only zero when the
corresponding bits in <code>mideleg</code> and <code>mvien</code> are both zero. The combined effects of <code>mideleg</code> and <code>mvien</code> on <code>sip</code> and <code>sie</code> are summarized in
<a href="#TableintrFilteringForS">The effects of <code>mideleg</code> and <code>mvien</code> on <code>sip</code> and <code>sie</code> (except for the H extension&#8217;s VS-level interrupts, which appear in <code>hip</code> and <code>hie</code> instead of <code>sip</code> and <code>sie</code>). A bit in <code>mvien</code> can be set to 1 only for major interrupts 1, 9, and 13-63. For interrupts 0-12, some aliases of <code>mip</code> bits in <code>sip</code> may be read-only copies, as specified by the base Privileged Architecture.</a>.</p>
</div>
<table id="TableintrFilteringForS" class="tableblock frame-all grid-all fit-content center">
<caption class="title">Table 4. The effects of <code>mideleg</code> and <code>mvien</code> on <code>sip</code> and <code>sie</code> (except for the H extension&#8217;s VS-level interrupts, which appear in <code>hip</code> and <code>hie</code> instead of <code>sip</code> and <code>sie</code>). A bit in <code>mvien</code> can be set to 1 only for major interrupts 1, 9, and 13-63. For interrupts 0-12, some aliases of <code>mip</code> bits in <code>sip</code> may be read-only copies, as specified by the base Privileged Architecture.</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">mideleg[\(n\)]</th>
<th class="tableblock halign-center valign-top">mvien[\(n\)]</th>
<th class="tableblock halign-center valign-top">sip[\(n\)]</th>
<th class="tableblock halign-center valign-top">sie[\(n\)]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Read-only 0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Read-only 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Alias of <code>mvip</code>[\(n\)]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Writable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Alias of <code>mip</code>[\(n\)]</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Alias of <code>mie</code>[\(n\)]</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The name of CSR <code>mvien</code> is not <code>"mvie"</code> because the function of this register is
more analogous to <code>mcounteren</code> than to <code>mie</code>. The bits of <code>mvien</code> control whether the virtual interrupt-pending bits in register <code>mvip</code> are active and visible at supervisor
level. This is different than how the usual interrupt-enable bits (such
as in <code>mie</code>) mask pending interrupts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A bit in <code>sie</code> is writable if and only if the corresponding bit is set in
either <code>mideleg</code> or <code>mvien</code>. When an interrupt is delegated by <code>mideleg</code>, the writable bit in <code>sie</code> is an alias of the corresponding bit in <code>mie</code>; else it is an independent
writable bit. As usual, bits that are not writable in <code>sie</code> must be read-only
zeros.</p>
</div>
<div class="paragraph">
<p>If a bit of <code>mideleg</code> is zero and the corresponding bit in <code>mvien</code> is changed from zero to one, then the value of the matching bit in <code>sie</code> becomes UNSPECIFIED. Likewise, if a bit of <code>mvien</code> is one and the corresponding bit in <code>mideleg</code> is changed from one to zero, the value of the matching bit in <code>sie</code> again becomes UNSPECIFIED.</p>
</div>
<div class="paragraph">
<p>For interrupt numbers 13-63, implementations may freely choose which
bits of <code>mvien</code> are writable and which bits are read-only zero or one. If such a
bit in <code>mvien</code> is read-only zero (preventing the virtual interrupt from being
enabled), the same bit should be read-only zero in <code>mvip</code>. All other bits for
interrupts 13-63 must be writable in <code>mvip</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Platform standards or other extensions may require that bits of <code>mvien</code> for
certain interrupt causes be writable, or be read-only zero or one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The bits of <code>mvien</code> for supervisor software interrupts (code 1) and supervisor
external interrupts (code 9) are each either writable or read-only zero;
they cannot be read-only ones. The other bits of <code>mvien</code> for interrupts 0-12 are
reserved and must be read-only zeros.</p>
</div>
<div class="paragraph">
<p>It is strongly recommended that bit 9 of <code>mvien</code> be writable. Furthermore, if
bit 1 (SSIP) of <code>mip</code> can be set automatically by an interrupt controller and
not just by explicit writes to <code>mip</code> or <code>sip</code>, it is strongly recommended that
bit 1 of <code>mvien</code> also be writable.</p>
</div>
<div class="paragraph">
<p>When bit 1 of <code>mvien</code> is zero, bit 1 of <code>mvip</code> is an alias of the same bit (SSIP) of <code>mip</code>. But when bit 1 of <code>mvien</code> is one, bit 1 of <code>mvip</code> is a separate writable bit
independent of <code>mip</code>.SSIP. When the value of bit 1 of <code>mvien</code> is changed from zero to
one, the value of bit 1 of <code>mvip</code> becomes UNSPECIFIED.</p>
</div>
<div class="paragraph">
<p>Bit 5 of <code>mvip</code> is an alias of the same bit (STIP) in <code>mip</code> when that bit is writable
in <code>mip</code>. When STIP is not writable in <code>mip</code> (such as when <code>menvcfg</code>.STCE = 1), bit 5 of <code>mvip</code> is read-only zero.</p>
</div>
<div class="paragraph">
<p>When bit 9 of <code>mvien</code> is zero, bit 9 of <code>mvip</code> is an alias of the software-writable
bit 9 of <code>mip</code> (SEIP). But when bit 9 of <code>mvien</code> is one, bit 9 of <code>mvip</code> is a writable bit independent of <code>mip</code>.SEIP. Unlike for bit 1, changing the value of bit 9 of <code>mvien</code>
does not affect the value of bit 9 of <code>mvip</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The base Privileged Architecture specifies unusual read/write behavior
for what it calls the software-writable SEIP bit of register <code>mip</code>.
When bit 9 of <code>mvien</code> is zero, bit 9 of <code>mvip</code> makes the software-writable SEIP bit of <code>mip</code> directly accessible by itself.
Furthermore, as explained below, setting bit 9 of <code>mvien</code> to one
separates the software-writable SEIP bit from <code>mip</code> entirely,
so it is then just a writable bit in <code>mvip</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Except for bits 1, 5, and 9 as specified above, the bits of <code>mvip</code> in the range
12:0 are reserved and must be read-only zeros.</p>
</div>
<div class="paragraph">
<p>The value of bit 9 of <code>mvien</code> has some additional consequences for supervisor
external interrupts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When bit 9 of <code>mvien</code> is zero, the software-writable SEIP bit (bit 9 of <code>mvip</code>)
interacts with reads and writes of <code>mip</code> in the way specified by the base RISC-V
Privileged Architecture. In particular, for most purposes, the value of
bit 9 of <code>mvip</code> is logically ORed into the readable value of <code>mip</code>.SEIP. But when
bit 9 of <code>mvien</code> is one, bit SEIP in <code>mip</code> is read-only and does not include the value
of bit 9 of <code>mvip</code>. Rather, the value of <code>mip</code>.SEIP is simply the supervisor
external interrupt signal from the hart&#8217;s external interrupt controller
(APLIC or IMSIC).</p>
</li>
<li>
<p>If the hart has an IMSIC, then when bit 9 of <code>mvien</code> is one, attempts from
S-mode to explicitly access the supervisor-level interrupt file raise an
illegal instruction exception. The exception is raised for attempts to
access CSR <code>stopei</code>, or to access <code>sireg</code> when <code>siselect</code> has a value in the range <code>0x70</code>-<code>0xFF</code>. Accesses to guest interrupt files (through <code>vstopei</code> or <code>viselect</code>+<code>vsireg</code>) are not affected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the H extension is implemented, if a bit is zero in the
same position in both <code>mideleg</code> and <code>mvien</code>, then that bit is read-only zero in <code>hideleg</code> (in addition to being read-only zero in <code>sip</code>, <code>sie</code>, <code>hip</code>, and <code>hie</code>). But if a bit for one of interrupts 13-63 is a one in either <code>mideleg</code> or <code>mvien</code>, then the same bit in <code>hideleg</code> may be writable or may be read-only zero, depending on the implementation. No bits in <code>hideleg</code> are ever read-only ones. The H extension further constrains bits 12:0 of <code>hideleg</code>.</p>
</div>
<div class="paragraph">
<p>When supervisor mode is implemented, the minimal required implementation of <code>mvien</code> and <code>mvip</code> has all bits being read-only zeros except for <code>mvip</code> bits 1 and 9, and sometimes bit 5, each of which is an alias of an existing writable bit in <code>mip</code>. (Although, as noted, it is strongly recommended that bit 9 of <code>mvien</code> also be writable.) When supervisor mode is not implemented, registers <code>mvien</code> and <code>mvip</code> do not exist.</p>
</div>
</div>
<div class="sect2">
<h3 id="intrs-S"><a class="anchor" href="#intrs-S"></a>Interrupts at supervisor level</h3>
<div class="paragraph">
<p>If a standard local interrupt becomes pending (= 1) in <code>sip</code>, the bit in <code>sip</code> is
writable and will remain set until cleared by software.</p>
</div>
<div class="paragraph">
<p>Just as for machine level, the taking of interrupt traps at supervisor level remains essentially the same as specified by the base RISC-V Privileged Architecture. An interrupt traps into S-mode (or HS-mode) whenever all of the following are true: (a) either the current privilege mode is S-mode and supervisor-level interrupts are enabled by the SIE bit of <code>sstatus</code>, or the current privilege mode has less privilege than S-mode; (b) matching bits in <code>sip</code> and <code>sie</code> are both one, or, if the H extension is implemented, matching bits in <code>hip</code> and <code>hie</code> are both one; and (c) if the H extension is implemented, the corresponding bit in <code>hideleg</code> is zero.</p>
</div>
<div class="sect3">
<h4 id="intrPrios-S"><a class="anchor" href="#intrPrios-S"></a>Configuring priorities of major interrupts at supervisor level</h4>
<div class="paragraph">
<p>Supervisor-level priorities for major interrupts 0-63 are optionally configurable in an array of supervisor-level <code>iprio</code>\(k\) registers accessed through  <code>siselect</code> and <code>sireg</code>. This array has the same structure when XLEN = 32 or 64 as does the machine-level <code>iprio</code> array. To summarize, when XLEN = 32, there are sixteen 32-bit registers with these <code>siselect</code> addresses:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3F</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio15</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each register controls the priorities of four interrupts, one 8-bit byte per interrupt. When XLEN = 64, only the even-numbered registers exist:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x3E</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iprio14</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each register controls the priorities of eight interrupts. If XLEN = 64 and <code>siselect</code> is an odd value in the range <code>0x31</code>-<code>0x3F</code>, attempting to access <code>sireg</code> raises an illegal instruction exception.</p>
</div>
<div class="paragraph">
<p>The valid registers <code>iprio0</code>-<code>iprio15</code> are known collectively as the <code><em>iprio</em></code> <em>array</em> for supervisor level. Each byte of a valid <code>iprio</code>\(k\) register is either a read-only zero or a <strong>WARL</strong> unsigned integer field implementing exactly IPRIOLEN bits.</p>
</div>
<div class="paragraph">
<p>For a given interrupt number, if the corresponding bit is not writable
either in <code>sie</code> or, if the H extension is implemented, in <code>hie</code>,
then the interrupt&#8217;s priority number in the supervisor-level <code>iprio</code> array must be read-only zero as well. The priority number for a supervisor-level external interrupt (bits 15:8 of <code>iprio2</code>) must also be read-only zero. Aside from these two restrictions, implementations may freely choose which priority number fields are settable and which are read-only zeros.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As always, platform standards may require that priorities be
configurable for certain interrupt causes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is expected that many higher-end systems will not support the ability
to configure the priorities of major interrupts at supervisor level as
described in this section. Linux in particular is not designed to take
advantage of such facilities if provided. The <code>iprio</code> array must be accessible
but may simply be all read-only zeros.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The supervisor-level <code>iprio</code> array accessed via <code>siselect</code> and <code>sireg</code> affects the prioritization of interrupts only when they trap to S-mode. When an interrupt&#8217;s priority number in the array is zero (either read-only zero or set to zero), its priority is the default order from <a href="#majorIntrs">Defined major interrupts and default priorities</a>. Setting an interrupt&#8217;s priority number instead to a nonzero value \(p\) gives that interrupt nominally the same priority as a supervisor-level external interrupt with priority number \(p\). For an interrupt that defaults to a higher priority than supervisor external interrupts, setting its priority number to a nonzero value lowers its priority. For an interrupt that defaults to a lower priority than supervisor external interrupts, setting its priority number to a nonzero value raises its priority. When two interrupt causes have been assigned the same nominal priority, ties are broken by the default priority order. <a href="#TableintrPrios-S">Effect of the supervisor-level iprio array on the priorities of interrupts taken in S-mode. For interrupts with the same priority number, the default order of Defined major interrupts and default priorities prevails.</a> summarizes the effect of priority numbers on interrupt priority.</p>
</div>
<div class="paragraph">
<p>If supported, setting the priority number for VS-level external interrupts (bits 23:16 of <code>iprio2</code>) to a nonzero value \(p\) has the effect of giving the entire category of VS external interrupts nominally  the same priority as a supervisor external interrupt with priority number \(p\), when VS external interrupts trap to S-mode.</p>
</div>
<table id="TableintrPrios-S" class="tableblock frame-all grid-all stretch center">
<caption class="title">Table 5. Effect of the supervisor-level iprio array on the priorities of interrupts taken in S-mode. For interrupts with the same priority number, the default order of <a href="#majorIntrs">Defined major interrupts and default priorities</a> prevails.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top">Interrupts with default priority above supervisor external interrupts</th>
<th class="tableblock halign-center valign-top">Supervisor external interrupts</th>
<th class="tableblock halign-center valign-top">Interrupts with default priority below supervisor external  interrupts</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority<br>
order</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority number in supervisor-level <code>iprio</code> array</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority number from interrupt controller (APLIC or IMSIC)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Priority number in supervisor-level <code>iprio</code> array</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Highest</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<br>
2<br>
&#8230;&#8203;<br>
254<br>
255</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<br>
2<br>
&#8230;&#8203;<br>
254<br>
255</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<br>
2<br>
&#8230;&#8203;<br>
254<br>
255</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">256 and above (IMSIC only)</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Lowest</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If bit 9 for a supervisor external interrupt (SEI) is one
in <code>mideleg</code> or <code>mvien</code> and in <code>mvip</code>, causing <code>sip</code>.SEIP to be one,
but there is no supervisor-level interrupt from the hart&#8217;s external
interrupt controller (APLIC or IMSIC), then a priority number for
the SEI is not supplied by the external interrupt controller as usual.
In that case, the SEI is assigned a priority number of 256.</p>
</div>
<div class="paragraph">
<p>If the system has an original PLIC for backward compatibility with older software, reset should initialize the supervisor-level <code>iprio</code> array to all zeros.</p>
</div>
</div>
<div class="sect3">
<h4 id="stopi"><a class="anchor" href="#stopi"></a>Supervisor top interrupt CSR (<code>stopi</code>)</h4>
<div class="paragraph">
<p>Supervisor-level CSR <code>stopi</code> is read-only with width SXLEN. A read of <code>stopi</code> returns information about the highest-priority pending-and-enabled interrupt for
supervisor level, in this format:</p>
</div>
<table class="tableblock frame-none grid-none fit-content center">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 27:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IID</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bits 7:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IPRIO</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All other bits of <code>stopi</code> are reserved and read as zeros.</p>
</div>
<div class="paragraph">
<p>The value of <code>stopi</code> is zero unless: (a) there is an interrupt that is both pending in <code>sip</code> and enabled in <code>sie</code>, or, if the H extension is implemented, both pending in <code>hip</code> and enabled in <code>hie</code>; and (b) the interrupt is not delegated to a less-privileged level (by <code>hideleg</code>, if the H extension is implemented). When there is a pending-and-enabled major interrupt for supervisor level, field IID is the major identity number of the highest-priority interrupt, and field IPRIO indicates its
priority.</p>
</div>
<div class="paragraph">
<p>If all bytes of the supervisor-level <code>iprio</code> array are read-only zeros, a simplified implementation of field IPRIO is allowed in which its value is always 1 whenever <code>stopi</code> is not zero.</p>
</div>
<div class="paragraph">
<p>Otherwise, when <code>stopi</code> is not zero, if the priority number for the reported interrupt is in the range 1 to 255, IPRIO is simply that number. If the interrupt&#8217;s priority number is zero or greater than 255, IPRIO is set to either 0 or 255 as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the interrupt&#8217;s priority number is greater than 255, then IPRIO is 255 (lowest representable priority).</p>
</li>
<li>
<p>If the interrupt&#8217;s priority number is zero and interrupt number IID has a default priority higher than a supervisor external interrupt, then IPRIO is 0 (highest priority).</p>
</li>
<li>
<p>If the interrupt&#8217;s priority number is zero and interrupt number IID has a default priority lower than a supervisor external interrupt, then IPRIO is 255 (lowest representable priority).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To ensure that <code>stopi</code> is never zero when an interrupt is pending and enabled for supervisor level, if major interrupt 0 can trap to S-mode, it must have a default priority lower than a supervisor external interrupt.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value of <code>stopi</code> is not affected by the global interrupt enable SIE in CSR <code>sstatus</code>.</p>
</div>
<div class="paragraph">
<p>The RISC-V Privileged Architecture ensures that, when the value of <code>stopi</code> is not zero, a trap is taken to S-mode for the interrupt indicated by field IID if either the current privilege mode is S and <code>sstatus</code>.SIE is one, or the current privilege mode has less privilege than S-mode. The trap itself does not cause the value of <code>stopi</code> to change.</p>
</div>
<div class="paragraph">
<p>The following pseudocode shows how a supervisor-level trap handler might
read <code>stopi</code> to avoid redundant restoring and saving of processor registers when
an interrupt arrives during the handling of another trap (either a
synchronous exception or an earlier interrupt):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">save processor registers
i = read CSR scause
if (i &gt;= 0) {
    handle synchronous exception i
    restore sstatus if necessary
}
if (sstatus.SPIE == 1) {
    loop {
        i = read CSR stopi
        if (i == 0) exit loop
        i = i&gt;&gt;16
        call the interrupt handler for major interrupt i
    }
}
restore processor registers
return from trap</code></pre>
</div>
</div>
<div class="paragraph">
<p>(This example can be further optimized, but with an increase in complexity.)</p>
</div>
<div class="paragraph">
<p>In order for this algorithm to function correctly, <code>sstatus</code>.SPIE must
be set to 1 before executing an SRET that changes the privilege mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Assuming <code>sstatus</code> is saved and restored by trap handlers at entry
and exit as is common, it is sufficient to set <code>sstatus</code>.SPIE = 1
only once, before the first use of SRET that changes privilege mode.
After an SRET, a trap back to S-mode will restore <code>sstatus</code>.SPIE = 1;
and if the trap handler preserves <code>sstatus</code>, it will
still be true before the next SRET that ends the handler.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wfi-wait-for-interrupt-instruction"><a class="anchor" href="#wfi-wait-for-interrupt-instruction"></a>WFI (Wait for Interrupt) instruction</h3>
<div class="paragraph">
<p>The RISC-V Privileged Architecture specifies that instruction WFI (Wait for Interrupt) may suspend execution at a hart until an interrupt is pending for the hart. The Advanced Interrupt Architecture (AIA) redefines when execution must resume following a WFI.</p>
</div>
<div class="paragraph">
<p>According to the base RISC-V Privileged Architecture, instruction execution must resume from a WFI whenever any interrupt is both pending and enabled in CSRs <code>mip</code> and <code>mie</code>, ignoring any delegation indicated by <code>mideleg</code>. With the AIA, this succinct rule is no longer appropriate, due to the mechanisms the AIA adds for virtual interrupts. Instead, execution must resume from a WFI whenever an interrupt is pending at any privilege level (regardless of whether the interrupt privilege level is higher or lower than the hart&#8217;s current privilege mode).</p>
</div>
<div class="paragraph">
<p>An interrupt is pending at machine level if register <code>mtopi</code> is not zero. If S-mode is implemented, an interrupt is pending at supervisor level if <code>stopi</code> is not zero. And if the H extension is implemented, an interrupt is pending at VS level if <code>vstopi</code> (<a href="#vstopi">[vstopi]</a>) is not zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The AIA&#8217;s rule for WFI gives the same behavior as the base Privileged Architecture’s rule when <code>mvien</code> = 0 and, if the H extension is implemented, also <code>hvien</code> = 0 and <code>hvictl</code>.VTI = 0, thus disabling all virtual interrupts not visible in <code>mip</code>. (The AIA&#8217;s hypervisor registers are covered in the next chapter, "Interrupts for Virtual Machines (VS Level)".)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="AdvPLIC.html">Advanced Platform-Level Interrupt Controller (APLIC)</a></span>
  <span class="next"><a href="VSLevel.html">Interrupts for Virtual Machines (VS Level)</a></span>
</nav>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../../ffh/v1.0/index.html">ACPI Functional Fixed Hardware</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../ffh/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="index.html">Advanced Interrupt Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../etrace/v1.0/index.html">E-Trace Encapsulation Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../etrace/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../psabi/v1.0/index.html">ELF psABI Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../psabi/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../iommuArch/v1.0/index.html">IOMMU Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../iommuArch/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../isa/index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../isa/index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../reri/v1.0/index.html">RERI Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../reri/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../qos/v1.0/index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../qos/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../plic/v1.0.0/index.html">RISC-V Platform-Level Interrupt Controller</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../plic/v1.0.0/index.html">
      v1.0.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../semihost/v1.0/index.html">semihosting</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../semihost/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
