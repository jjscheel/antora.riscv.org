<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RISC-V Duo-PLIC for the Advancced Interrupt Architecture :: RISC-V Ratified Specifications Library</title>
    <meta name="generator" content="Antora 3.1.12">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/spring-tabs.css">

    <meta name="antora-ui-version" content="3f4ce2c51445edcfc62ee1f59ab97fffc218fb79"> 
    <meta name="version" content="v1.0">
    <meta name="component" content="aia">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">RISC-V Ratified Specifications Library</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="aia" data-version="v1.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Advanced Interrupt Architecture</span>
  <span class="version">v1.0</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
  </div><ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">RISC-V Advanced Interrupt Architecture</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="CSRs.html">Control and Status Registers (CSRs) Added to Harts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IMSIC.html">Incoming MSI Controller (IMSIC)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="AdvPLIC.html">Advanced Platform-Level Interrupt Controller (APLIC)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="MSLevel.html">Interrupts for Machine and Supervisor Levels</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="VSLevel.html">Interrupts for Virtual Machines (VS Level)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IPIs.html">Interprocessor Interrupts (IPIs)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link"  href="IOMMU.html">IOMMU Support for MSIs to Virtual Machines</a>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title="RISC-V Duo-PLIC for the Advancced Interrupt Architecture"
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/riscv/riscv-aia/edit/antora-refactor/modules/ROOT/pages/riscv-duoplic.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/riscv/riscv-aia" title="GitHub">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>

      <a href="" title="PDF">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          Download PDF
        </a>
    </div>
  </div>
</aside>
<article class="doc">
<div class="breadcrumbs-container">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul>
      <li><a href="index.html">Advanced Interrupt Architecture</a></li>
      <li><a href="riscv-duoplic.html"><strong>RISC-V Duo-PLIC for the Advancced Interrupt Architecture</strong><br></a></li>
    </ul>
  </nav>
</div><h1 id="page-title" class="page"><strong>RISC-V Duo-PLIC for the Advancced Interrupt Architecture</strong><br></h1>
<div class="paragraph">
<p><code>jh.riscv@jhauser.us</code><br>
<br>
2023-07-04</p>
</div>
<div class="paragraph">
<p><strong>Warning! This document is only a draft and might never be accepted by
the RISC-V International Association. If accepted, the Duo-PLIC
specification here is liable to change before becoming a ratified
standard.</strong></p>
</div>
<div class="paragraph">
<p>Contributors to all versions of this specification in alphabetical order
(please contact the editor to suggest corrections): John Hauser.</p>
</div>
<div class="paragraph">
<p>This document is released under a Creative Commons Attribution 4.0
International License.</p>
</div>
<div class="paragraph">
<p>The Advanced PLIC of the RISC-V Advanced Interrupt Architecture is not
backward compatible with the original RISC-V PLIC. To ease the
transition of software from the original PLIC to the APLIC, a RISC-V
system may have a <em>Duo-PLIC</em> that software can configure to act as
either form of PLIC. A Duo-PLIC is an extension of an APLIC, having all
the usual memory-mapped interfaces of an APLIC, plus, at some other
memory addresses, the memory-mapped interface of an original RISC-V PLIC
too. When the Duo-PLIC has <em>compatibility mode</em> enabled, interrupts from
the Duo-PLIC to harts are controlled exclusively by the original PLIC
side of the Duo-PLIC; and when compatibility mode is disabled,
interrupts to harts are controlled exclusively by the APLIC side of the
Duo-PLIC. A Duo-PLIC comes out of reset with compatibility mode enabled,
so older software with no knowledge of an APLIC can see the Duo-PLIC as
an original PLIC.</p>
</div>
<div class="paragraph">
<p>When compatibility mode is enabled so a Duo-PLIC acts as an original
PLIC, the Duo-PLIC supports only the direct delivery of interrupts to
harts, not the forwarding of interrupts by MSIs. When compatibility mode
is disabled and the Duo-PLIC acts as an APLIC, direct delivery mode is
supported for all interrupt domains, and MSI delivery mode may
optionally be supported. Hence, for each APLIC interrupt domain, field
DM (Delivery Mode) of the <code>‘=̀domaincfg</code> register is either read-only
zero or writable, but is not read-only one.</p>
</div>
<div class="paragraph">
<p>In the memory-mapped control region for the APLIC root interrupt domain
(only), a Duo-PLIC adds to the <code>‘=̀domaincfg</code> register a CM
(Compatibility Mode) field in bit 6. The complete format of the root
interrupt domain’s <code>‘=̀domaincfg</code> is thus:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bits 31:24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read-only <code>‘=̀0x80</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read-only 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM (<strong>WARL</strong>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BE (<strong>WARL</strong>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All other register bits are reserved and read as zeros.</p>
</div>
<div class="paragraph">
<p>Reset initializes the APLIC root domain’s <code>‘=̀domaincfg</code> register with CM
= 1 and with all other writable bits zeros.</p>
</div>
<div class="paragraph">
<p>When CM = 1 (compatibility mode enabled):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For each <em>context</em> implemented by the original PLIC side of the
Duo-PLIC, the output interrupt for that context becomes the interrupt
signal delivered from the Duo-PLIC to the specific hart and privilege
level specified by the implementation. Other than the CM field of the
APLIC root domain’s <code>‘=̀domaincfg</code> register, the state of the APLIC side
of the Duo-PLIC is irrelevant to the interrupts delivered to harts.</p>
</li>
<li>
<p>In the memory-mapped control region for each APLIC interrupt domain:</p>
<div class="ulist">
<ul>
<li>
<p>Fields IE and DM of the <code>‘=̀domaincfg</code> register are read-only zeros.</p>
</li>
<li>
<p>Field BE of the <code>‘=̀domaincfg</code> register has its usual function for the
interrupt domain but has no effect on accesses to the registers of the
original PLIC side of the Duo-PLIC.</p>
</li>
<li>
<p>If they exist, the registers that configure MSI addresses
(<code>‘=̀mmsiaddrcfg</code>, <code>‘=̀mmsiaddrcfgh</code>, <code>‘=̀smsiaddrcfg</code>, and
<code>‘=̀smsiaddrcfgh</code>) remain functional.</p>
</li>
<li>
<p>All other registers are read-only zeros. Writes to the registers are
ignored.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When CM = 0 (compatibility mode disabled):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interrupts to harts are determined by the APLIC side of the Duo-PLIC.
The state of the original PLIC side of the Duo-PLIC is irrelevant.</p>
</li>
<li>
<p>In the memory-mapped control region for the original PLIC side of the
Duo-PLIC, all registers are read-only zeros. Writes to the registers are
ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the Duo-PLIC’s compatibility mode is changed from disabled to
enabled, the registers of the original PLIC side of the Duo-PLIC obtain
valid and consistent but otherwise unspecified values.</p>
</div>
<div class="paragraph">
<p>If the Duo-PLIC’s compatibility mode is changed from enabled to
disabled, the registers of the APLIC side of the Duo-PLIC obtain valid
and consistent but otherwise unspecified values, except for the
<code>‘=̀domaincfg</code> registers and, if they exist, the registers that configure
MSI addresses (<code>‘=̀mmsiaddrcfg</code>, <code>‘=̀mmsiaddrcfgh</code>, <code>‘=̀smsiaddrcfg</code>, and
<code>‘=̀smsiaddrcfgh</code>), all of which retain their previous values. (The root
domain’s <code>‘=̀domaincfg</code> gets the value written when changing field CM, of
course.)</p>
</div>
<div class="paragraph">
<p>The endianness of the memory-mapped registers of the original PLIC side
of the Duo-PLIC is not affected by the BE field of any APLIC
<code>‘=̀domaincfg</code> register. For most, maybe all versions of an original
PLIC, the registers are always little-endian.</p>
</div>
<div class="paragraph">
<p>The number of interrupt priority levels supported by the original PLIC
side of a Duo-PLIC is the same as that of the APLIC side when in direct
delivery mode. Hence, the number of integer bits to store a priority
number, IPRIOLEN, is a constant for a Duo-PLIC (in the range 1 to 8 as
usual), independent of whether compatibility mode is enabled or
disabled.</p>
</div>
<div class="paragraph">
<p>However, an original PLIC encodes priorities in the opposite order from
an IMSIC or APLIC, with number 1 being interpreted as the lowest
priority and larger numbers as higher priorities. When a Duo-PLIC is
acting as an original PLIC and reports to a hart an interrupt priority
number, the number reported is negated to <em>normalize</em> it to the
convention of the Advanced Interrupt Architecture. If the original
PLIC’s priority number for an interrupt is \(p\), the
normalized priority number communicated to the target hart is
\({\mbox{2}^\textrm{IPRIOLEN}-p}\).</p>
</div>
<div class="paragraph">
<p>__</p>
</div>
<hr>
<div class="paragraph">
<p>Negation of original PLIC priority numbers to normalize them matters
only when a hart supports configurability of the priorities of major
interrupts, an option added by the Advanced Interrupt Architecture.
Software that is oblivious to the Advanced Interrupt Architecture should
have no reason to see priority numbers being negated.</p>
</div>
</article>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
                  <ul class="nav-versions">
                      <li class="component">
                        <div>
                          <a class="title" href="../../ffh/v1.0/index.html">ACPI Functional Fixed Hardware</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../ffh/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="index.html">Advanced Interrupt Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../etrace/v1.0/index.html">E-Trace Encapsulation Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../etrace/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../psabi/v1.0/index.html">ELF psABI Specification</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../psabi/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../iommuArch/v1.0/index.html">IOMMU Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../iommuArch/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../isa/index.html">ISA Specifications</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../isa/index.html">
      default
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../reri/v1.0/index.html">RERI Architecture</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../reri/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../qos/v1.0/index.html">RISC-V Capacity and Bandwidth QoS Register Interface</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../qos/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../plic/v1.0.0/index.html">RISC-V Platform-Level Interrupt Controller</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../plic/v1.0.0/index.html">
      v1.0.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                      <li class="component">
                        <div>
                          <a class="title" href="../../semihost/v1.0/index.html">semihosting</a>
                        </div>                        <div class="version-item is-active">
                          <div>
                            <button class="version-toggle" type="button">
                              <span></span>
                              Stable
                            </button>
                          </div>
                          <ul class="versions">
  <li class="version">
    <a href="../../semihost/v1.0/index.html">
      v1.0
    </a>
  </li>
</ul>                        </div>
                        
                      </li>
                  </ul>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="hidden">
</footer><script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/spring-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>
  </body>
</html>
